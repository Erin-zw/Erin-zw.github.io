<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":{"home":"/","about":"/about","tags":"/tags"}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="来者犹可追">
<meta property="og:type" content="website">
<meta property="og:title" content="Erin枫">
<meta property="og:url" content="http://example.com/page/5/index.html">
<meta property="og:site_name" content="Erin枫">
<meta property="og:description" content="来者犹可追">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Erin-zw">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Erin枫</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/rss2.xml" title="Erin枫" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
       
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Erin枫</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="download fa-fw"></i>资源</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/18/py/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Erin-zw">
      <meta itemprop="description" content="来者犹可追">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Erin枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/18/py/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">函数式编程</a>
        </h2>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-18 20:54:36" itemprop="dateCreated datePublished" datetime="2023-06-18T20:54:36+08:00">2023-06-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-14 21:53:19" itemprop="dateModified" datetime="2023-09-14T21:53:19+08:00">2023-09-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/py/" itemprop="url" rel="index"><span itemprop="name">py</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="返回函数"><a href="#返回函数" class="headerlink" title="返回函数"></a>返回函数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lazy_sum</span>(<span class="params">*args</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sum</span>():</span></span><br><span class="line">        ax = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> args:</span><br><span class="line">            ax = ax + n</span><br><span class="line">        <span class="keyword">return</span> ax</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line">f = lazy_sum(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">f1 = lazy_sum(<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>)</span><br><span class="line">f2 = lazy_sum(<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>)</span><br><span class="line"><span class="built_in">print</span>(f1 == f2)</span><br><span class="line"><span class="built_in">print</span>(f,f1,f2)	</span><br><span class="line"><span class="built_in">print</span>(f(),f1(),f2())</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line">&lt;function lazy_sum.&lt;<span class="built_in">locals</span>&gt;.<span class="built_in">sum</span> at <span class="number">0x000001712A9790D0</span>&gt; &lt;function lazy_sum.&lt;<span class="built_in">locals</span>&gt;.<span class="built_in">sum</span> at <span class="number">0x000001712A979160</span>&gt; &lt;function lazy_sum.&lt;<span class="built_in">locals</span>&gt;.<span class="built_in">sum</span> at <span class="number">0x000001712A9791F0</span>&gt;</span><br><span class="line"><span class="number">10</span> <span class="number">25</span> <span class="number">25</span></span><br></pre></td></tr></table></figure>

<h2 id="全局变量和局部变量"><a href="#全局变量和局部变量" class="headerlink" title="全局变量和局部变量"></a>全局变量和局部变量</h2><p>关于gobal关键字：如果真的想要在函数体内修改全局变量的值，就要使用global关键字。使用global关键字就是告诉python编译器这个变量不是局部变量而是全局变量，其实有点像是”引用”的意思</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span>():</span></span><br><span class="line">    <span class="keyword">global</span> num1</span><br><span class="line">    num1 = <span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;修改后num1为&#x27;</span>,num1)</span><br><span class="line">num1 = <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;初始num1&#x27;</span>,num1)</span><br><span class="line">fun()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;运行函数后num1&#x27;</span>,num1)</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line">初始num1 <span class="number">1</span></span><br><span class="line">修改后num1为 <span class="number">2</span></span><br><span class="line">运行函数后num1 <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>关于nonlocal关键字</p>
<p>nonlocal声明的变量不是局部变量,也不是全局变量,而是外部嵌套函数内的变量。</p>
<p>关键字：nonlocal</p>
<p>　　1.外部必须有这个变量（对全局变量无效）</p>
<p>　　2.在内部函数声明nonlocal变量之前不能再出现同名变量</p>
<p>　　3.内部修改这个变量如果想在外部有这个变量的第一层函数中生效（只是对最近的一层的局部变量有效）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span>():</span></span><br><span class="line">    num2 = <span class="number">3</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fun2</span>():</span></span><br><span class="line">        <span class="keyword">nonlocal</span> num2</span><br><span class="line">        num2 *= <span class="number">2</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;num2 =&quot;</span>,num2)</span><br><span class="line">    <span class="keyword">return</span> fun2()</span><br><span class="line">fun()</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line">num2 = <span class="number">6</span></span><br></pre></td></tr></table></figure>

<h2 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>闭包（Closure）是Python中的高级概念，它只出现在嵌套函数中，但和嵌套函数有很大的不同，那就是闭包使用了一个叫自由变量的东西。</p>
<p>实际中，闭包就是一个函数，只不过这个函数可以引用没有在该函数内部定义的变量，这个函数本身可以是匿名函数也可以是非匿名函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_averager</span>():</span></span><br><span class="line">    series = []</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">averager</span>(<span class="params">new_value</span>):</span></span><br><span class="line">        series.append(new_value)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;series in averager:&quot;</span>,series)</span><br><span class="line">        total = <span class="built_in">sum</span>(series)</span><br><span class="line">        <span class="keyword">return</span> total / <span class="built_in">len</span>(series)</span><br><span class="line">    <span class="keyword">return</span> averager</span><br><span class="line">avg = make_averager()</span><br><span class="line"><span class="built_in">print</span>(avg(<span class="number">10</span>))</span><br><span class="line"><span class="built_in">print</span>(avg(<span class="number">11</span>))<span class="comment">#实际上此处avg调用都是同一个函数averager</span></span><br><span class="line">avg1 = make_averager()</span><br><span class="line"><span class="built_in">print</span>(avg1(<span class="number">10</span>))</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line">series <span class="keyword">in</span> averager: [<span class="number">10</span>]</span><br><span class="line"><span class="number">10.0</span></span><br><span class="line">series <span class="keyword">in</span> averager: [<span class="number">10</span>, <span class="number">11</span>]</span><br><span class="line"><span class="number">10.5</span></span><br><span class="line">series <span class="keyword">in</span> averager: [<span class="number">10</span>]</span><br><span class="line"><span class="number">10.0</span></span><br></pre></td></tr></table></figure>

<p>看出端倪了吗?通过调用avg(n）就可以实现更新历史series并且计算当前series的平均值。那么到底是如何实现更新series 呢?讲道理，series是 make_averager函数中定义的一个局部变量，并且当通过avg(n)调用时，明显make_averager已经被执行过了，应该就访问不到series变量了。<br>实际上在嵌套函数 averager中，series是一个自由变量(free variable)，表明这个变量没有被绑定在局部作用域中，同时averager函数的闭包行为使得它可以访问到这个自由变量。</p>
<img src="/images/py/函数式编程/1.png" style="zoom:67%;">

<p>上面代码中的 series 是可变变量，在内部函数中使用时没有问题，但如果是不可变变量，如 string、number、tuple 等，在内部函数引用则会报错。</p>
<h3 id="闭包的各种解释"><a href="#闭包的各种解释" class="headerlink" title="闭包的各种解释"></a>闭包的各种解释</h3><h4 id="解释1"><a href="#解释1" class="headerlink" title="解释1"></a>解释1</h4><p>通过一个函数返回父函数里的一个局部变量，延长那个变量的生命周期。</p>
<h4 id="解释2"><a href="#解释2" class="headerlink" title="解释2"></a>解释2</h4><ul>
<li>在一个外函数中定义了一个内函数</li>
<li>内函数用到了外函数的临时变量</li>
<li>外函数的返回值是内函数的引用</li>
</ul>
<h4 id="解释3"><a href="#解释3" class="headerlink" title="解释3"></a>解释3</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#闭包函数的实例</span></span><br><span class="line"><span class="comment">#outer是外部函数，a和b都是外函数的临时变量</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span>(<span class="params">a</span>):</span></span><br><span class="line">    b = <span class="number">10</span></span><br><span class="line">    <span class="comment">#inner是内函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>():</span></span><br><span class="line">        <span class="comment">#在内函数中用到了外函数的临时变量</span></span><br><span class="line">        <span class="built_in">print</span>(a + b)</span><br><span class="line">    <span class="comment">#外函数的返回值是内函数的引用</span></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#在这里我们调用外函数传入参数5</span></span><br><span class="line">    <span class="comment">#此时外函数两个临时变量a是5，b是10，并创建了内函数，然后把内函数的引用返回存给了demo</span></span><br><span class="line">    <span class="comment">#外函数结束的时候发现内部函数将会用到自己的临时变量，这两个临时变量就不会释放，会绑定</span></span><br><span class="line">    demo = outer(<span class="number">5</span>)</span><br><span class="line">    <span class="comment">#我们调用内部函数，看一看内部函数是不是能使用外部函数的临时变量</span></span><br><span class="line">    <span class="comment">#demo存了外部函数的返回值，也就是inner函数的引用，这里相当于执行inner函数</span></span><br><span class="line">    demo()<span class="comment">#15</span></span><br><span class="line">    </span><br><span class="line">    demo2 = outer(<span class="number">7</span>)</span><br><span class="line">    demo2()<span class="comment">#17</span></span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line"><span class="number">15</span></span><br><span class="line"><span class="number">17</span></span><br></pre></td></tr></table></figure>

<h4 id="我的解释"><a href="#我的解释" class="headerlink" title="我的解释"></a>我的解释</h4><p>如下所示，我来做一个解释，fs.append(f)向列表里添加的实际上是一个函数，当循环完过后返回的列表fs实际上是三个函数变量，至于输出为什么不是1，4，9而是9，9，9。原因是i三次循环过后变成了3，所以输出都为9.实际上运行三次循环给列表赋值后，i就已经变成了3，下面调用时则都是9.。如第二段代码所示，f（i)立即被执行所以输出会变化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span>():</span></span><br><span class="line">    fs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">4</span>):</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f</span>():</span></span><br><span class="line">            <span class="keyword">return</span> i * i</span><br><span class="line">        fs.append(f)</span><br><span class="line">    <span class="keyword">return</span> fs</span><br><span class="line">f1,f2,f3 = count()</span><br><span class="line"><span class="built_in">print</span>(f1(),f2(),f3())</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line"><span class="number">9</span> <span class="number">9</span> <span class="number">9</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">j</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">g</span>():</span></span><br><span class="line">            <span class="keyword">return</span> j * j</span><br><span class="line">        <span class="keyword">return</span> g</span><br><span class="line">    fs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">4</span>):</span><br><span class="line">        fs.append(f(i))</span><br><span class="line">    <span class="keyword">return</span> fs</span><br><span class="line">f1,f2,f3 = count()</span><br><span class="line"><span class="built_in">print</span>(f1(),f2(),f3())</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line"><span class="number">1</span> <span class="number">4</span> <span class="number">9</span></span><br></pre></td></tr></table></figure>

<h3 id="关于判断闭包函数的方法"><a href="#关于判断闭包函数的方法" class="headerlink" title="关于判断闭包函数的方法"></a>关于判断闭包函数的方法</h3><p>若输出有cell关键字则表示是一个闭包函数。若是None则表明不是一个闭包函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line">    name = <span class="string">&#x27;eva&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>():</span></span><br><span class="line">        <span class="built_in">print</span>(name)</span><br><span class="line">    <span class="built_in">print</span>(inner.__closure__)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line">f = func()</span><br><span class="line">f()</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line">(&lt;cell at <span class="number">0x000002017FE206D0</span>: <span class="built_in">str</span> <span class="built_in">object</span> at <span class="number">0x000002017FD8DB70</span>&gt;,)</span><br><span class="line">eva</span><br></pre></td></tr></table></figure>

<h2 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h2><p>lambda可以作为函数返回值，也可以赋值给变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="keyword">lambda</span> x: x * x</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mypow3</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">lambda</span> x: x * x * x</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(<span class="built_in">map</span>(f,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>])))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(<span class="built_in">map</span>(mypow3(),[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>])))</span><br><span class="line">L = <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x % <span class="number">2</span> == <span class="number">1</span>,<span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>)))</span><br><span class="line"><span class="built_in">print</span>(L)</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">8</span>, <span class="number">27</span>, <span class="number">64</span>, <span class="number">125</span>, <span class="number">216</span>, <span class="number">343</span>, <span class="number">512</span>, <span class="number">729</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">17</span>, <span class="number">19</span>]</span><br></pre></td></tr></table></figure>

<h2 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h2><p>我们要增强now()函数的功能，比如，在函数调用前后自动打印日志，但又不希望修改now()函数的定义，这种在代码运行期间动态增加功能的方式，称之为“装饰器”（Decorator）。装饰器要写在函数定义前面。本质上，decorator就是一个返回函数的高阶函数。所以，我们要定义一个能打印日志的decorator。我们要借助Python的@语法，把decorator置于函数的定义处。</p>
<p>此处来讲一下now函数运行的调用过程，调用now时，首先要明白@log的实际上是一个赋值，now &#x3D; log（‘execute’）（now），这样的话先调用log返回decorator，decorator无内容返回wrapper，wrapper执行打印返回func函数。因为我们讲了函数也是对象，它有__name__等属性，但你去看经过decorator装饰之后的函数，它们的__name__已经从原来的’now’变成了’wrapper’。因为返回的那个wrapper()函数名字就是’wrapper’，所以，需要把原始函数的__name__等属性复制到wrapper()函数中，否则，有些依赖函数签名的代码执行就会出错。</p>
<p>不需要编写wrapper.__name__ &#x3D; func.__name__这样的代码，Python内置的functools.wraps就是干这个事的，所以，一个完整的decorator的写法如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span>(<span class="params">text</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span>(<span class="params">func</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kw </span>):</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;%s %s():&#x27;</span>%(text, func.__name__))</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kw )</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"><span class="meta">@log(<span class="params"><span class="string">&#x27;execute&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">now</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;2021-9-11&#x27;</span>)</span><br><span class="line">f = now</span><br><span class="line"><span class="built_in">print</span>(f.__name__)</span><br><span class="line">now()</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line">wrapper</span><br><span class="line">execute now():</span><br><span class="line"><span class="number">2021</span>-<span class="number">9</span>-<span class="number">11</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span>(<span class="params">text</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span>(<span class="params">func</span>):</span></span><br><span class="line"><span class="meta">        @functools.wraps(<span class="params">func</span>)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kw </span>):</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;%s %s():&#x27;</span>%(text, func.__name__))</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kw )</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"><span class="meta">@log(<span class="params"><span class="string">&#x27;execute&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">now</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;2021-9-11&#x27;</span>)</span><br><span class="line">f = now</span><br><span class="line"><span class="built_in">print</span>(f.__name__)</span><br><span class="line">now()</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line">now</span><br><span class="line">execute now():</span><br><span class="line"><span class="number">2021</span>-<span class="number">9</span>-<span class="number">11</span></span><br></pre></td></tr></table></figure>

<p>对如下代码做一个解释，res实际上是None，他是fn函数执行后的返回值，由于fn函数没有实际返回值所以返回None，实际上可以去掉res &#x3D; fn和return res这两句。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span>(<span class="params">fn</span>):</span></span><br><span class="line"><span class="meta">    @functools.wraps(<span class="params">fn</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kw </span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;begin call %s():&#x27;</span> %fn.__name__)</span><br><span class="line">        res = fn(*args, **kw )</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;end call %s():&#x27;</span> %fn.__name__)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"><span class="meta">@log</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">now</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;2021-9-11&#x27;</span>)</span><br><span class="line">f = now</span><br><span class="line">now()</span><br><span class="line"><span class="built_in">print</span>(now())</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line">begin call now():</span><br><span class="line"><span class="number">2021</span>-<span class="number">9</span>-<span class="number">11</span></span><br><span class="line">end call now():</span><br><span class="line">begin call now():</span><br><span class="line"><span class="number">2021</span>-<span class="number">9</span>-<span class="number">11</span></span><br><span class="line">end call now():</span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure>

<h2 id="偏函数"><a href="#偏函数" class="headerlink" title="偏函数"></a>偏函数</h2><p>简单总结functools.partial的作用就是，把一个函数的某些参数给固定住（也就是设置默认值），返回一个新的函数，调用这个新函数会更简单。</p>
<p>注意到上面的新的int2函数，仅仅是把base参数重新设定默认值为2，但也可以在函数调用时传入其他值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line">int2 = functools.partial(<span class="built_in">int</span>, base = <span class="number">2</span> )</span><br><span class="line"><span class="built_in">print</span>(int2(<span class="string">&#x27;1101&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(int2(<span class="string">&#x27;10000&#x27;</span>, base = <span class="number">10</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">int</span>(<span class="number">1101</span>))</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line"><span class="number">13</span></span><br><span class="line"><span class="number">10000</span></span><br><span class="line"><span class="number">1101</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/18/Matlab/Test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Erin-zw">
      <meta itemprop="description" content="来者犹可追">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Erin枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/18/Matlab/Test/" class="post-title-link" itemprop="url">测试</a>
        </h2>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-18 20:54:36" itemprop="dateCreated datePublished" datetime="2023-06-18T20:54:36+08:00">2023-06-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-19 21:17:42" itemprop="dateModified" datetime="2023-09-19T21:17:42+08:00">2023-09-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Matlab/" itemprop="url" rel="index"><span itemprop="name">Matlab</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>296</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="复数矩阵的转置共轭共轭转置">复数矩阵的转置、共轭、共轭转置</h4>
<p>conj是共轭运算 <span class="math display">\[
A =
\begin{bmatrix}
2+3i &amp; 3-4i \\ 5+i &amp; 7-2i
\end{bmatrix}
\ \\
conj(A) =
\begin{bmatrix}
2-3i &amp; 3+4i \\ 5-i &amp; 7+2i
\end{bmatrix}
\ \\
A.&#39; =
\begin{bmatrix}
2+3i &amp; 5+i \\ 3-4i &amp; 7-2i
\end{bmatrix}
\ \\
conj(A.&#39;) = A&#39; =
\begin{bmatrix}
2-3i &amp; 5-i \\ 3+4i &amp; 7+2i
\end{bmatrix}
\]</span></p>

      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/18/Csharp/%E6%93%8D%E4%BD%9C%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Erin-zw">
      <meta itemprop="description" content="来者犹可追">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Erin枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/18/Csharp/%E6%93%8D%E4%BD%9C%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">dicom图像操作代码分析</a>
        </h2>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-18 20:54:36" itemprop="dateCreated datePublished" datetime="2023-06-18T20:54:36+08:00">2023-06-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-20 15:38:06" itemprop="dateModified" datetime="2023-04-20T15:38:06+08:00">2023-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">C#学习</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="移动操作"><a href="#移动操作" class="headerlink" title="移动操作"></a>移动操作</h2><p>对dicom图像进行移动操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">// 定义一个指针类型变量，用于记录鼠标在图像上的初始位置</span><br><span class="line">      private Point _startPoint;</span><br><span class="line"></span><br><span class="line">      // 定义一个变量，用于记录图像当前的位置</span><br><span class="line">      private Point _imageLocation;</span><br><span class="line"></span><br><span class="line">      private void pictureBox1_MouseDown(object sender, MouseEventArgs e)//鼠标左击事件发生</span><br><span class="line">      &#123;</span><br><span class="line">          if (e.Button == MouseButtons.Left)</span><br><span class="line">          &#123;</span><br><span class="line">              _startPoint = e.Location;//记录鼠标按下时的位置，也即图像的起始位置</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      private void pictureBox1_MouseMove(object sender, MouseEventArgs e)//光标拖动事件发生</span><br><span class="line">      &#123;</span><br><span class="line">          if (e.Button == MouseButtons.Left &amp;&amp; _startPoint != null)//如果鼠标左键任然按下进行以下操作</span><br><span class="line">          &#123;</span><br><span class="line">              int x = _imageLocation.X + (e.Location.X - _startPoint.X);//定义新位置的x坐标</span><br><span class="line">              int y = _imageLocation.Y + (e.Location.Y - _startPoint.Y);//y坐标</span><br><span class="line"></span><br><span class="line">              // 将图像移动到新的位置</span><br><span class="line">              pictureBox1.Location = new Point(x, y);//使用Location方法移动图像至新的位置</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      private void pictureBox1_MouseUp(object sender, MouseEventArgs e)//鼠标抬起事件</span><br><span class="line">      &#123;</span><br><span class="line">          if (e.Button == MouseButtons.Left)</span><br><span class="line">          &#123;</span><br><span class="line">              _imageLocation = pictureBox1.Location;//将图像在鼠标抬起后的位置赋值给变量，方便进行下一次的移动操作</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="放大缩小操作"><a href="#放大缩小操作" class="headerlink" title="放大缩小操作"></a>放大缩小操作</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">float zoomFactor = 1.0f;//缩放因子，初始值为1</span><br><span class="line"></span><br><span class="line">private void button1_Click(object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    // 增加放大比例，并更新pictureBox1控件大小和SizeMode</span><br><span class="line">    zoomFactor += 0.1f;</span><br><span class="line">    pictureBox1.Size = new Size((int)(pictureBox1.Image.Width * zoomFactor), (int)(pictureBox1.Image.Height * zoomFactor));</span><br><span class="line">    pictureBox1.SizeMode = PictureBoxSizeMode.Zoom;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void button2_Click(object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    // 减小放大比例，并更新控件大小和SizeMode</span><br><span class="line">    zoomFactor -= 0.1f;</span><br><span class="line">    pictureBox1.Size = new Size((int)(pictureBox1.Image.Width * zoomFactor), (int)(pictureBox1.Image.Height * zoomFactor));</span><br><span class="line">    pictureBox1.SizeMode = PictureBoxSizeMode.Zoom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="旋转操作"><a href="#旋转操作" class="headerlink" title="旋转操作"></a>旋转操作</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">private void button3_Click(object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    // 获取目前控件中的Image对象赋值给一个新的Image类型变量</span><br><span class="line">    Image currentImage = pictureBox1.Image;</span><br><span class="line"></span><br><span class="line">    //使用自带的RotateFlip旋转翻转方法，使用参数RotateFlipType.Rotate90FlipNone实现旋转图像90°无翻转</span><br><span class="line">    currentImage.RotateFlip(RotateFlipType.Rotate90FlipNone);</span><br><span class="line"></span><br><span class="line">    // 将操作后的currentImage更新至控件图像</span><br><span class="line">    pictureBox1.Image = currentImage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/18/Csharp/%E4%BA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Erin-zw">
      <meta itemprop="description" content="来者犹可追">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Erin枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/18/Csharp/%E4%BA%8C/" class="post-title-link" itemprop="url">dicom图像显示代码分析</a>
        </h2>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-18 20:54:36" itemprop="dateCreated datePublished" datetime="2023-06-18T20:54:36+08:00">2023-06-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-20 13:36:58" itemprop="dateModified" datetime="2023-04-20T13:36:58+08:00">2023-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">C#学习</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>15 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>由于先前并未学习使用过C#，本文采用<strong>Chatgpt</strong>进行辅助分析。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.ComponentModel;</span><br><span class="line">using System.Data;</span><br><span class="line">using System.Drawing;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Windows.Forms;</span><br><span class="line">//using System.Drawing;</span><br><span class="line">using System.Drawing.Imaging;</span><br><span class="line">using System.IO;</span><br><span class="line">using System.Runtime;</span><br><span class="line">using System.Runtime.Serialization;</span><br><span class="line">using System.Runtime.Serialization.Formatters;</span><br><span class="line">using System.Runtime.Serialization.Formatters.Binary;</span><br><span class="line">using Dicom;</span><br><span class="line">using Dicom.IO;</span><br><span class="line">using Dicom.IO.Buffer;</span><br><span class="line">using Dicom.Imaging;</span><br><span class="line">using Dicom.Imaging.Codec;</span><br><span class="line">using Dicom.Imaging.Codec.Jpeg;</span><br><span class="line">using System.Runtime.InteropServices;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">namespace DrawingDCMExample //定义总命名空间</span><br><span class="line">&#123;</span><br><span class="line">    public partial class DICOMProcessDemo : Form //这段代码定义了一个名为DICOMProcessDemo的类，该类继承自Form类，并被定义为public和partial。由于它被定义为partial，可以在其他文件中定义该类的其他部分。</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// The Image member that inserted in PictureBox</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        </span><br><span class="line">        private string defaultImageBG;//用于存放默认背景的路径</span><br><span class="line">        </span><br><span class="line">        public DICOMProcessDemo()//DICOMProcessDemo类的初始化</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            //这个方法的作用是初始化窗体中的控件，包括将控件添加到窗体中、设置控件的位置和大小、以及绑定事件处理程序等。</span><br><span class="line">            string appPath = Application.StartupPath;//定义appPath为程序启动路径</span><br><span class="line">            string imagePath = appPath + @&quot;\..\..\..\..\&quot; + @&quot;Resource\defaultbackgroundImage.bmp&quot;;</span><br><span class="line">            //具体地说，这个路径是通过将appPath（应用程序的路径）与一个相对路径拼接而成的。其中，@&quot;........&quot;表示向上跳四级目录，即到应用程序所在的根目录，然后再跳到Resource文件夹下，最后再拼接上文件名&quot;defaultbackgroundImage.bmp&quot;。</span><br><span class="line">            //换句话说，这个路径指向了应用程序根目录下的Resource文件夹中的一个名为&quot;defaultbackgroundImage.bmp&quot;的位图文件。</span><br><span class="line">            defaultImageBG = imagePath;</span><br><span class="line">            pictureBox1.Image = Image.FromFile(imagePath);</span><br><span class="line">            //PictureBox是一个Windows Forms控件，用于在用户界面中显示图像。Image属性是PictureBox控件中用于存储和显示图像的属性。通过将其设置为从文件加载的图像，可以更改PictureBox控件中显示的图像。</span><br><span class="line">			//Image.FromFile方法是一个静态方法，它可以从文件加载图像并返回一个Image对象。将返回的Image对象赋给PictureBox控件的Image属性，从而更改控件中显示的图像。</span><br><span class="line">            DicomTranscoder.LoadCodecs(Application.StartupPath, &quot;Dicom.Native*.dll&quot;);</span><br><span class="line">            //这段代码DicomTranscoder.LoadCodecs(Application.StartupPath, &quot;Dicom.Native*.dll&quot;);是用于加载DICOM图像编解码器的代码。</span><br><span class="line">			//在这里，DicomTranscoder是一个用于DICOM图像编解码的类。LoadCodecs是该类的一个静态方法，用于从指定目录中加载编解码器。Application.StartupPath是指当前应用程序的启动路径，而&quot;Dicom.Native*.dll&quot;则是指定要加载的编解码器的文件名模式。*通配符表示任何字符。通过加载编解码器，我们可以在应用程序中使用DICOM图像，并将其转换为其他格式，例如BMP或JPEG，以在屏幕上显示或进行分析。</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void openToolStripMenuItem_Click(object sender, EventArgs e)</span><br><span class="line">            	//是一个事件处理方法，它是在用户单击菜单项 &quot;openToolStripMenuItem&quot; 时触发的。该方法的主要功能是打开一个文件对话框，允许用户选择一个文件，并将选择的文件加载到应用程序中。</span><br><span class="line">        &#123;</span><br><span class="line">            using(openFileDialog1 = new OpenFileDialog())</span><br><span class="line">                //这是 C# 中的一个 using 语句块，用于在代码块执行结束时自动释放资源。在这个例子中，using 语句块用于打开一个文件对话框，并在选择文件后自动关闭对话框并释放资源。</span><br><span class="line">            &#123;</span><br><span class="line">                openFileDialog1.Filter=&quot;DCM files(*.DCM)|*.DCM| dcm files(*.dcm)|*.dcm&quot;;</span><br><span class="line">                //这行代码是为 OpenFileDialog 对象设置一个过滤器，限制用户在打开文件对话框时只能选择特定类型的文件。</span><br><span class="line">				//在这个例子中，Filter 属性的值为 &quot;DCM files(*.DCM)|*.DCM| dcm files(*.dcm)|*.dcm&quot;，表示可以选择后缀名为 .dcm 或 .DCM 的文件。该属性值的格式为 &quot;文件类型描述|文件扩展名&quot;，多个文件类型描述和文件扩展名之间用竖线 | 分隔，每个文件类型描述和文件扩展名之间用逗号 , 分隔。</span><br><span class="line">				//因此，在这个例子中，文件类型描述分别为 &quot;DCM files&quot; 和 &quot;dcm files&quot;，文件扩展名分别为 &quot;*.DCM&quot; 和 &quot;*.dcm&quot;。用户在打开文件对话框时，只能选择这两种类型的文件，其他类型的文件会被过滤掉，不会显示在对话框中。在这里括号是进一步说明文件类型。</span><br><span class="line">                openFileDialog1.RestoreDirectory=true;</span><br><span class="line">				//作用是在关闭文件对话框后，恢复到打开文件对话框前的目录。这样做的好处是避免了在用户打开文件对话框时意外地改变了当前目录，从而导致后续操作出现问题的情况。</span><br><span class="line">                if (openFileDialog1.ShowDialog() == DialogResult.OK)//检查用户是否在文件打开对话框中单击了确认按钮</span><br><span class="line">                &#123;</span><br><span class="line">                    string dcmPath = openFileDialog1.FileName.ToString();//dcm文件路径存储在 OpenFileDialog 类的 FileName 属性中。转换为字符串并存储在 dcmPath 变量中。</span><br><span class="line">                    //string dcmFileName = Path.Substring(Path.LastIndexOf(&quot;\\&quot;) + 1);</span><br><span class="line">                    listView1.Items.Clear();//清空 ListView 控件，以便准备向其中添加新项</span><br><span class="line">                    ShowAndDrawingDCMImage(dcmPath);//加载和显示 DICOM 文件中的图像。</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// Show the metaInfo of the DCM file and Drawing the image on the Screen</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=&quot;dcmFileName&quot;&gt;The path of your DCM file&lt;/param&gt;</span><br><span class="line">        private void ShowAndDrawingDCMImage(string dcmFileName)//加载显示DICOM图像</span><br><span class="line">        &#123;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                DicomFile dcmFile = DicomFile.Open(dcmFileName);//执行此行代码后，将拥有一个DicomFile对象，该对象表示由dcmFileName参数指定的DICOM文件</span><br><span class="line">                LoadAndShowDCMMetaInfo(dcmFile);//加载和显示dicom文件的元数据信息</span><br><span class="line">                listView1.Update();//ListView控件刷新其显示并根据其基础数据源更新其内容	</span><br><span class="line">                DrawingDCMData2Screen(dcmFile);//使用DICOM文件中的数据进行图像处理，并将其绘制到屏幕上，以便用户可以查看医学影像</span><br><span class="line">            &#125;</span><br><span class="line">            catch (System.Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                MessageBox.Show(ex.Message);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// Load all of the Elements in the DCM Meta </span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=&quot;dcm&quot;&gt;the DICOM file&lt;/param&gt;</span><br><span class="line">        private void LoadAndShowDCMMetaInfo(DicomFile dcm)</span><br><span class="line">        &#123;</span><br><span class="line">            //Show the message of DCM file to the listview in the dialog.</span><br><span class="line">            DicomDataset dcmDataset = dcm.Dataset;//dcm对象数据集存储到变量</span><br><span class="line">            DicomFileMetaInformation dcmMetaInfo = dcm.FileMetaInfo;//dcm对象文件元信息存储到变量</span><br><span class="line">            listView1.BeginUpdate();</span><br><span class="line">            //控件的显示将暂时被挂起。在调用BeginUpdate()方法之后，通常会对控件中的项和子项进行更改，然后再调用EndUpdate()方法。这样可以确保控件的显示更新只会在所有更改完成后才执行，从而避免出现不必要的重绘操作。</span><br><span class="line">            //DICOM MetaInfo</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(dcmMetaInfo.MediaStorageSOPClassUID==null?&quot;&quot;:dcmMetaInfo.MediaStorageSOPClassUID.ToString()))//利用String.IsNullOrWhiteSpace方法，判断dcm文件中的SOP类的UID信息是否为空</span><br><span class="line">            &#123;</span><br><span class="line">                //Insert the ImplementationClassUID，</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0002&quot;);</span><br><span class="line">                //用group号“0002”创建ListViewItem对象赋值给newItem变量。也就是说，ListViewItem的构造函数被调用，传入了一个表示Tag Group Number为&quot;0002&quot;的字符串。这个字符串将被作为该ListViewItem的主显示文本（即第一列）</span><br><span class="line">                newItem.SubItems.Add(&quot;0002&quot;);</span><br><span class="line">                //在ListView控件中，每一行都可以有多个列（即子项），用来显示多个数据。因此，在创建ListViewItem对象之后，可以通过调用ListViewItem的SubItems属性，来获取该项的子项集合。通过调用Add方法，可以向该集合中添加新的子项。这里添加的子项是Tag Element number</span><br><span class="line">                newItem.SubItems.Add(dcmMetaInfo.MediaStorageSOPClassUID.ToString());</span><br><span class="line">                //第三列添加SOP类UID信息</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">                //将包含DICOM文件Tag Group Number、Tag Element Number和SOP类UID信息的newItem对象添加到了listView1控件的行集合中，使其显示在控件中。</span><br><span class="line">            &#125;</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(dcmMetaInfo.MediaStorageSOPInstanceUID==null?&quot;&quot;:dcmMetaInfo.MediaStorageSOPInstanceUID.ToString()))</span><br><span class="line">            &#123;</span><br><span class="line">                //Insert the ImplementationClassUID</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0002&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0003&quot;);</span><br><span class="line">                newItem.SubItems.Add(dcmMetaInfo.MediaStorageSOPInstanceUID.ToString());</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line"></span><br><span class="line">            &#125;//添加SOP实例UID信息</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(dcmMetaInfo.TransferSyntax==null?&quot;&quot;:dcmMetaInfo.TransferSyntax.ToString()))</span><br><span class="line">            &#123;</span><br><span class="line">                //Insert the ImplementationClassUID</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0002&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0010&quot;);</span><br><span class="line">                newItem.SubItems.Add(dcmMetaInfo.TransferSyntax.ToString());</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line"></span><br><span class="line">            &#125;//添加传输语法UID信息</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(dcmMetaInfo.ImplementationClassUID==null?&quot;&quot;:dcmMetaInfo.ImplementationClassUID.ToString()))</span><br><span class="line">            &#123;</span><br><span class="line">                //Insert the ImplementationClassUID</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0002&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0012&quot;);</span><br><span class="line">                newItem.SubItems.Add(dcmMetaInfo.ImplementationClassUID.ToString());</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line"></span><br><span class="line">            &#125;//添加实现类UID信息，实现类 UID（Implementation Class UID）是DICOM中的一个标识符，用于表示医学图像设备或软件的厂商和型号信息。</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(dcmMetaInfo.ImplementationVersionName==null?&quot;&quot;:dcmMetaInfo.ImplementationVersionName.ToString()))</span><br><span class="line">            &#123;</span><br><span class="line">                //Insert the ImplementationClassUID</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0002&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0013&quot;);</span><br><span class="line">                newItem.SubItems.Add(dcmMetaInfo.ImplementationVersionName.ToString());</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line"></span><br><span class="line">            &#125;//添加版本号信息。DICOM 设备或软件的制造商会将 ImplementationVersionName 的值设置为特定的版本号或修订号。</span><br><span class="line"></span><br><span class="line">            //Patient Info</span><br><span class="line">            string patientName = dcmDataset.Get&lt;string&gt;(DicomTag.PatientName, &quot;&quot;);</span><br><span class="line">            //Get&lt;T&gt; 方法是 Dicom 数据集中的一个通用方法，用于获取指定标签号（Tag）对应的值，并将其转换为指定类型 T。在这里DicomTag.PatientName是一个表示患者姓名的标签号，并且使用空字符作为默认值。</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(patientName))</span><br><span class="line">            &#123;</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0010&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0010&quot;);</span><br><span class="line">                newItem.SubItems.Add(patientName);</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">            &#125;//添加患者姓名信息</span><br><span class="line">            string patientID = dcmDataset.Get&lt;string&gt;(DicomTag.PatientID, &quot;&quot;);</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(patientID))</span><br><span class="line">            &#123;</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0010&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0020&quot;);</span><br><span class="line">                newItem.SubItems.Add(patientID);</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">            &#125;//添加患者ID信息</span><br><span class="line">            string patientBirth = dcmDataset.Get&lt;string&gt;(DicomTag.PatientBirthDate);</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(patientBirth))</span><br><span class="line">            &#123;</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0010&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0030&quot;);</span><br><span class="line">                newItem.SubItems.Add(patientBirth);</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">            &#125;//添加患者生日信息</span><br><span class="line">            string patientSex = dcmDataset.Get&lt;string&gt;(DicomTag.PatientSex);</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(patientSex))</span><br><span class="line">            &#123;</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0010&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0040&quot;);</span><br><span class="line">                newItem.SubItems.Add(patientSex);</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">            &#125;//添加患者性别信息</span><br><span class="line">            string patientAge = dcmDataset.Get&lt;string&gt;(DicomTag.PatientAge);</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(patientAge))</span><br><span class="line">            &#123;</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0010&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;1010&quot;);</span><br><span class="line">                newItem.SubItems.Add(patientAge);</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">            &#125;//添加患者年龄信息</span><br><span class="line">            //Study &amp; Series Info</span><br><span class="line">            string studyDate = dcmDataset.Get&lt;string&gt;(DicomTag.StudyDate);</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(studyDate))</span><br><span class="line">            &#123;</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0008&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0020&quot;);</span><br><span class="line">                newItem.SubItems.Add(studyDate);</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">            &#125;//添加检查日期信息</span><br><span class="line">            string studyTime = dcmDataset.Get&lt;string&gt;(DicomTag.StudyTime);</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(studyTime))</span><br><span class="line">            &#123;</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0008&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0030&quot;);</span><br><span class="line">                newItem.SubItems.Add(studyTime);</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">            &#125;//添加检查的具体时间，包括时分秒和毫秒</span><br><span class="line">            string studyInstanceID = dcmDataset.Get&lt;string&gt;(DicomTag.StudyInstanceUID);</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(studyInstanceID))</span><br><span class="line">            &#123;</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0020&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;000D&quot;);</span><br><span class="line">                newItem.SubItems.Add(studyInstanceID);</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">            &#125;//添加病人检查唯一标志符信息，用于唯一标识病人的一次检查（即一个 study），它是一个由数字和句点组成的字符串，全球唯一，可用于跨医院或跨系统的病人信息交换。</span><br><span class="line">            string seriesInstanceID = dcmDataset.Get&lt;string&gt;(DicomTag.SeriesInstanceUID);</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(seriesInstanceID))</span><br><span class="line">            &#123;</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0020&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;000E&quot;);</span><br><span class="line">                newItem.SubItems.Add(seriesInstanceID);</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">            &#125;//添加了一次检查中某个影像序列的唯一标识符，SeriesInstanceUID 标签用于唯一标识一组相关的影像（即一个 series），它也是一个由数字和句点组成的字符串，全球唯一。</span><br><span class="line">            string studyID = dcmDataset.Get&lt;string&gt;(DicomTag.StudyID);</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(studyID))</span><br><span class="line">            &#123;</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0020&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0010&quot;);</span><br><span class="line">                newItem.SubItems.Add(studyID);</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">            &#125;//添加了病人的检查编号信息。StudyID 标签用于识别一个病人的检查，通常由医院或机构自己定义。</span><br><span class="line">            //Image Info</span><br><span class="line">            string imageHeight = dcmDataset.Get&lt;string&gt;(DicomTag.Rows);</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(imageHeight))</span><br><span class="line">            &#123;</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0028&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0010&quot;);</span><br><span class="line">                newItem.SubItems.Add(imageHeight);</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">            &#125;//添加图像高度信息，图像高度就是像素行数，也即Rows</span><br><span class="line">            string imageWidth = dcmDataset.Get&lt;string&gt;(DicomTag.Columns);</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(imageWidth))</span><br><span class="line">            &#123;</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0028&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0011&quot;);</span><br><span class="line">                newItem.SubItems.Add(imageWidth);</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">            &#125;//添加图像宽度信息，图像宽度就是像素列数，也即Columns</span><br><span class="line">            string bitsAlloctaed = dcmDataset.Get&lt;string&gt;(DicomTag.BitsAllocated);</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(bitsAlloctaed))</span><br><span class="line">            &#123;</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0028&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0100&quot;);</span><br><span class="line">                newItem.SubItems.Add(bitsAlloctaed);</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">            &#125;//添加图像像素深度信息，图像像素深度就是像素所占用的位数，常见位数为8，16，32.</span><br><span class="line">            string bitsStored = dcmDataset.Get&lt;string&gt;(DicomTag.BitsStored);</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(bitsStored))</span><br><span class="line">            &#123;</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0028&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0101&quot;);</span><br><span class="line">                newItem.SubItems.Add(bitsStored);</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">            &#125;//添加图像实际像素深度信息。在DICOM中，像素深度可以分配比实际位深度更多的位，但实际位深度表示图像实际存储的精度。通常情况下，实际位深度等于或小于像素深度。</span><br><span class="line">            string highBits = dcmDataset.Get&lt;string&gt;(DicomTag.HighBit);</span><br><span class="line">            //这行代码是用于从DICOM数据集中获取像素值中最高位的位位置。在DICOM中，像素值是一个整数，其位数由像素深度决定，每个像素值可以被解释为灰度值或颜色分量等。</span><br><span class="line">            if (!String.IsNullOrWhiteSpace(highBits))</span><br><span class="line">            &#123;</span><br><span class="line">                ListViewItem newItem = new ListViewItem(&quot;0028&quot;);</span><br><span class="line">                newItem.SubItems.Add(&quot;0102&quot;);</span><br><span class="line">                newItem.SubItems.Add(highBits);</span><br><span class="line">                listView1.Items.Add(newItem);</span><br><span class="line">            &#125;//添加二进制像素值最高位位置信息</span><br><span class="line">            listView1.EndUpdate();//结束控件显示更新</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// Drawing the image in your DCM to the Dialog</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=&quot;dcm&quot;&gt;&lt;/param&gt;</span><br><span class="line">        private void DrawingDCMData2Screen(DicomFile dcm)//在窗口上显示dicom影像的bmp格式图象</span><br><span class="line">        &#123;</span><br><span class="line">            pictureBox1.Image = ConvertDCMData2BitImage(dcm);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// Convert the byte data retrieved from DCM file to Image</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=&quot;imagedata&quot;&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">        private Bitmap ConvertDCMData2BitImage(DicomFile dcm)//将dcm格式转换为bmp格式</span><br><span class="line">        &#123;</span><br><span class="line">            DicomFile newDcmFile = null;//定义一个空dicom文件用于存放压缩dicom文件实例</span><br><span class="line">            if (dcm.FileMetaInfo.TransferSyntax.IsEncapsulated)//判断传输语法是否被压缩</span><br><span class="line">            &#123;</span><br><span class="line">               // System.Reflection.Assembly.LoadFrom(Path.Combine(Application.StartupPath,&quot;Dicom.Native64.dll&quot;));</span><br><span class="line">                DicomTranscoder.LoadCodecs(Application.StartupPath, &quot;Dicom.Native*.dll&quot;);</span><br><span class="line">                newDcmFile=dcm.ChangeTransferSyntax(DicomTransferSyntax.ExplicitVRLittleEndian,new DicomJpegLsParams());//使用ExplicitVRLittleEndian传输语法，指定图像压缩算法以便后续处理            </span><br><span class="line">            &#125;</span><br><span class="line">            DicomImage imageDcm=null;//定义空的dicom图像类用于存放压缩dicom文件的图像信息</span><br><span class="line">            if (newDcmFile != null)//如果是被压缩的dicom文件，那么newDcmFile非空</span><br><span class="line">                imageDcm = new DicomImage(newDcmFile.Dataset);//将newDcmFile的数据集作为参数创建dicom图像类对象</span><br><span class="line">            else</span><br><span class="line">                imageDcm = new DicomImage(dcm.Dataset);//不是压缩文件就直接使用函数传入的dcm文件</span><br><span class="line">            DicomDataset dataset = dcm.Dataset;//使用变量方便传输</span><br><span class="line">            byte[] fs = imageDcm.PixelData.NumberOfFrames &lt; 2 ? imageDcm.PixelData.GetFrame(0).Data : imageDcm.PixelData.GetFrame(1).Data;//使用条件运算符判断是否是多帧图像，如果图象只有一帧，那么就是使用第0帧的图像数据，如果是多帧图像，那么就选用第1帧的图像数据。将图像数据存放在字节类型的数组fs中。</span><br><span class="line">            uint size = (uint)Marshal.SizeOf(typeof(short));//获取short类型的大小用于后续处理</span><br><span class="line">            uint padding = (uint)fs.Length % size;//字节数组长度与 short 类型大小的余数</span><br><span class="line">            uint count = (uint)fs.Length / size;//字节数组长度与 short 类型大小的商</span><br><span class="line">            short[] values = new short[count];//创建short类型数组存放基本的16位像素单元</span><br><span class="line">            System.Buffer.BlockCopy(fs, 0, values, 0, (int)(fs.Length - padding));//将字节数组复制到short类型数组中</span><br><span class="line"></span><br><span class="line">            int height = dataset.Get&lt;int&gt;(DicomTag.Rows);//获取图像高度，也即行数</span><br><span class="line">            int width = dataset.Get&lt;int&gt;(DicomTag.Columns);//获取图像宽度，也即列数</span><br><span class="line">            int windowsWidth = (int)dataset.Get&lt;double&gt;(DicomTag.WindowWidth);//窗宽定义</span><br><span class="line">            int windowsCenter = (int)dataset.Get&lt;double&gt;(DicomTag.WindowCenter);//窗位定义</span><br><span class="line">            //if the windowsWidth = 0, the DCM file is not standard type.</span><br><span class="line">            if (windowsWidth == 0 || windowsCenter==0)//对非标准dicom文件进行处理，并进行相应窗位窗宽计算</span><br><span class="line">            &#123;</span><br><span class="line">                windowsWidth = values.Max&lt;short&gt;()-values.Min&lt;short&gt;();</span><br><span class="line">                windowsCenter = windowsWidth / 2;</span><br><span class="line">            &#125;</span><br><span class="line">            int low = windowsCenter - windowsWidth / 2;//计算窗的范围</span><br><span class="line">            int high = windowsCenter + windowsWidth / 2;</span><br><span class="line">            Bitmap bitmap = new Bitmap(width, height);</span><br><span class="line">            for (int i = 0; i &lt; height; ++i)</span><br><span class="line">            &#123;</span><br><span class="line">                for (int j = 0; j &lt; width; ++j)</span><br><span class="line">                &#123;</span><br><span class="line">                    int r, g, b;</span><br><span class="line">                    int temp = (int)values[(width - j - 1) * height + i];</span><br><span class="line">                    int val = temp &gt; high ? 255 : (temp &lt; low ? 0 : ((temp - low) * 255 / windowsWidth));</span><br><span class="line">                    r = g = b = val;</span><br><span class="line">                    bitmap.SetPixel(i, width-j-1, Color.FromArgb(r, g, b));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;//相当于从第一行末端到第一行第一个元素使用数组元素进行像素值赋值，接着第二行末端到第二行第一个元素，以此类推。</span><br><span class="line">            return bitmap;//返回Bitmap类型对象</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void aboutToolStripMenuItem_Click(object sender, EventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            MessageBox.Show(&quot;The program is just a demo written by C# using fo-dicom!****zssure****&quot;);</span><br><span class="line">        &#125;//帮助里的help提示</span><br><span class="line"></span><br><span class="line">        private void closeToolStripMenuItem_Click(object sender, EventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            listView1.Items.Clear();//清空ListView控件</span><br><span class="line">            pictureBox1.Image = Image.FromFile(defaultImageBG);//将图像替换成默认背景</span><br><span class="line">            MessageBox.Show(&quot;The close is just back to original state.Please click &#x27;X&#x27; to exit! &quot;);</span><br><span class="line">        &#125;//close选项提示</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/18/C%E5%92%8CC++/%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Erin-zw">
      <meta itemprop="description" content="来者犹可追">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Erin枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/18/C%E5%92%8CC++/%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8/" class="post-title-link" itemprop="url">预处理器</a>
        </h2>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-18 20:54:36" itemprop="dateCreated datePublished" datetime="2023-06-18T20:54:36+08:00">2023-06-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-05 18:16:18" itemprop="dateModified" datetime="2023-09-05T18:16:18+08:00">2023-09-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>编译一个C程序第一个步骤叫做预处理阶段，C预处理器在源代码编译之前对其进行一些文本性质操作。</p>
<h2 id="预定义符号"><a href="#预定义符号" class="headerlink" title="预定义符号"></a>预定义符号</h2><table>
<thead>
<tr>
<th>符号</th>
<th>例子</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>__FILE__</td>
<td>“name.c”</td>
<td>进行编译的源文件名称</td>
</tr>
<tr>
<td>__LINE__</td>
<td>25</td>
<td>文件当前行的行号</td>
</tr>
<tr>
<td>__DATE__</td>
<td>“Jan 17 2021”</td>
<td>文件被编译的日期</td>
</tr>
<tr>
<td>__TIME__</td>
<td>“11:34:01”</td>
<td>文件被编译的时间</td>
</tr>
<tr>
<td>__STDC__</td>
<td>1</td>
<td>如果编译器遵循ANSI C值就为1，否则未定义</td>
</tr>
</tbody></table>
<h2 id="define"><a href="#define" class="headerlink" title="#define"></a>#define</h2><p>声明格式：<code>#define name stuff</code></p>
<p>例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEBUG_PRINT printf(<span class="meta-string">&quot;FILE %s line &quot;</span>\ </span></span><br><span class="line"><span class="string">&quot;%d: x=%d, y=%d,&quot;</span>\    <span class="comment">//相邻的字符串常量自动被连接</span></span><br><span class="line"><span class="string">&quot;z=%d&quot;</span>,__FILE__,__LINE__,x,y,z)<span class="comment">//注意此处没有分号</span></span><br></pre></td></tr></table></figure>

<h3 id="宏"><a href="#宏" class="headerlink" title="宏"></a>宏</h3><p>声明格式：<code>#define name(parameter-list) stuff</code></p>
<p>例子1：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S(x) x*x</span></span><br><span class="line">a = <span class="number">5</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,S(a+<span class="number">1</span>));<span class="comment">//输出11，原因是将a+1替换，会变成a+1*a+1,不是我们想要的结果</span></span><br><span class="line"><span class="comment">//修改</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S(s) (x)*(x)</span></span><br></pre></td></tr></table></figure>

<p>例子2：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S(x) (x)+(x)</span></span><br><span class="line">a = <span class="number">5</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="number">10</span>*S(a));<span class="comment">//输出55，原因是将a替换，会变成10*(a)+(a),不是我们想要的结果</span></span><br><span class="line"><span class="comment">//修改</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S(s) ((x)*(x))</span></span><br></pre></td></tr></table></figure>

<p>例子3：#结构是把宏参数转换为字符串</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PRINT(FORMAT,VALUE) printf(<span class="meta-string">&quot;The value of &quot;</span>#VALUE  <span class="meta-string">&quot; is &quot;</span>FORMAT<span class="meta-string">&quot;\n&quot;</span>,VALUE)<span class="comment">//别吵别吵，这里很关键</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> **argv)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">22</span>;</span><br><span class="line">    PRINT(<span class="string">&quot;%d&quot;</span>,x+<span class="number">3</span>);</span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出</span></span><br><span class="line">The value of x+<span class="number">3</span> is <span class="number">25</span></span><br></pre></td></tr></table></figure>

<p>例子4：##结构是把两边的符号连接成一个</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ADD(number,value) sum ## number += value</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> **argv)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum5 = <span class="number">0</span>;<span class="comment">//前提是变量已经定义过</span></span><br><span class="line">    ADD(<span class="number">5</span>,<span class="number">25</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,sum5);</span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="副作用宏"><a href="#副作用宏" class="headerlink" title="副作用宏"></a>副作用宏</h3><p>例子1：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX(a,b) ((a)&gt;(b)?(a):(b))<span class="comment">//与参数类型无关</span></span></span><br><span class="line">...</span><br><span class="line">x = <span class="number">5</span>;</span><br><span class="line">y = <span class="number">8</span>;</span><br><span class="line">z = MAX(x++,y++);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d,%d,%d&quot;</span>,x,y,z);</span><br><span class="line"><span class="comment">//输出为6，10，9</span></span><br><span class="line"><span class="comment">//带入分析可知 z = ((x++)&gt;(y++)?(x++):(y++));</span></span><br></pre></td></tr></table></figure>

<p>例子2：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EVENPARITY(ch) ((cbit(ch)&amp;1)?(ch)|PARITYBIT:(ch))<span class="comment">//奇偶检验，PARITYBIT为1</span></span></span><br><span class="line">ch = EVENPARITY(getchar());<span class="comment">//这条语句实际上是失败的，因为getchar()实际上有两个，还有一个回车</span></span><br></pre></td></tr></table></figure>

<h3 id="undef"><a href="#undef" class="headerlink" title="#undef"></a>#undef</h3><p>作用是移除一个宏定义</p>
<p>声明格式：<code>#undef name</code></p>
<h2 id="条件编译"><a href="#条件编译" class="headerlink" title="条件编译"></a>条件编译</h2><p>一般格式</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> constant-expression<span class="comment">//常量表达式</span></span></span><br><span class="line">		statements</span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> constant-expression</span></span><br><span class="line">        other statements...</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span> </span></span><br><span class="line">        other statements</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p><strong>是否被定义</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(symbol)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> symbol<span class="comment">//等价</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined(symbol)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> symbol</span></span><br></pre></td></tr></table></figure>

<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><p>一般来讲#include尖括号是函数库文件，双引号是本地文件。</p>
<p><strong>多重包含：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;a.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;b.h&quot;</span></span></span><br><span class="line"><span class="comment">//如果两个文件都包含了x.h文件，就会造成多重包含</span></span><br></pre></td></tr></table></figure>

<p>解决方法就是条件编译：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _HEADERNAME_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _HEADERNAME_H 1<span class="comment">//此处1可加可不加，不加1的话，变量就是一个空字符串</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>当头文件第一次被包含时，变量未定义就给它定义，第二次多重包含时，ifndef条件为假内容就被忽略，不会被多次编译</p>
<h3 id="其他指令"><a href="#其他指令" class="headerlink" title="其他指令"></a>其他指令</h3><ul>
<li><p><code>#error text of error mesage</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(A)</span></span><br><span class="line">	...</span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(B)</span></span><br><span class="line">    ...</span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(C)</span></span><br><span class="line">    ...</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span> </span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">error</span> No selected</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>#line number &quot;string&quot;</code>他告诉预处理器number是下一行输入的行号，如果加入了string，预处理器就把它当作文件的名字。这条指令将修改__FILE__和__LINE__</p>
</li>
</ul>

      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/18/C%E5%92%8CC++/%E9%93%BE%E6%8E%A5%E5%B1%9E%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Erin-zw">
      <meta itemprop="description" content="来者犹可追">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Erin枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/18/C%E5%92%8CC++/%E9%93%BE%E6%8E%A5%E5%B1%9E%E6%80%A7/" class="post-title-link" itemprop="url">链接属性和存储类型</a>
        </h2>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-18 20:54:36" itemprop="dateCreated datePublished" datetime="2023-06-18T20:54:36+08:00">2023-06-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-05 18:15:35" itemprop="dateModified" datetime="2023-09-05T18:15:35+08:00">2023-09-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="链接属性"><a href="#链接属性" class="headerlink" title="链接属性"></a>链接属性</h2><h3 id="什么是链接属性？"><a href="#什么是链接属性？" class="headerlink" title="什么是链接属性？"></a>什么是链接属性？</h3><p>当组成一个程序的各个源文件分别被编译后,所有的目标文件以及那些从一个或多个函数库中引用的函数链接在一起,形成可执行程序.</p>
<p>标识符的链接属性决定如何处理在不同文件中出现的标识符.标识符作用域与它的链接属性有关,但这两个属性并不相同.</p>
<h3 id="链接属性分为三种"><a href="#链接属性分为三种" class="headerlink" title="链接属性分为三种:"></a>链接属性分为三种:</h3><ol>
<li>external(外部):external链接属性的标识符不管声明几次,存在于多少个源文件,都是属于一个个体.</li>
<li>internal(内部):internal链接属性的标识符在同一个源文件内所有声明都是同一个个体,但在其他源文件中多个声明分属不同个体.</li>
<li>none(无):没有链接属性的标识符(none)总是当成单独个体,也就是多次声明被当做多个不同的实体.</li>
</ol>
<p><strong>缺省情况下：</strong></p>
<p>函数和代码块之外的标识符链接属性为external,代码块之内的标识符链接属性为none</p>
<p>如下所示，b，c，f链接属性为external，其他的为none：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">char</span>* a;</span><br><span class="line"><span class="keyword">int</span> b;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">c</span><span class="params">(<span class="keyword">int</span> d)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> e;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> g)</span></span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改链接属性的关键字："><a href="#修改链接属性的关键字：" class="headerlink" title="修改链接属性的关键字："></a>修改链接属性的关键字：</h3><p><strong>static:</strong></p>
<ol>
<li>对于缺省情况下为external链接属性的声明,在声明前加static,会使这个标识符变成这个源文件私有,这样可以防止它被其他源文件调用.</li>
<li>对于缺省情况下为none链接属性的声明,在声明前加static,不会改变这个标识符的链接属性,也不会改变它的作用域,但会改变它的存储类型(生命周期),让它在程序执行的整个过程中一直存在.</li>
</ol>
<p><strong>extern:</strong></p>
<ol>
<li>在声明前加extern,会为这个标识符指定external链接属性.这样就可以在其他源文件声明的外部定义这个实体.</li>
<li>如果标识符在第一次声明中已经指定了链接属性,那么extern在后面的第二次或以后的声明中,不会更改第一次声明所指定的链接属性.</li>
</ol>
<h2 id="存储类型"><a href="#存储类型" class="headerlink" title="存储类型"></a><strong>存储类型</strong></h2><p>变量的存储类型是指存储变量值的内存类型。有三个地方可以用于存储变量：普通内存、运行时堆栈、硬件寄存器。变量的缺省存储类型取决于它的声明位置。</p>
<ol>
<li><p>凡是在<strong>任何代码块之外声明的变量</strong>总是存储于静态内存中，也就是<strong>不属于堆栈</strong>的内存，这类变量称为<strong>静态(static)变量</strong>。静态变量在程序运行之前创建，更确切的说，是在将可执行文件加载到内存的时候创建，其在程序的整个执行期间始终存在。</p>
</li>
<li><p>在<strong>代码块内部</strong>声明的变量的缺省存储类型是<strong>自动的(automatic)</strong>, 也就是说它存储于<strong>堆栈中</strong>，称为自动变量。有一个关键字auto就是用于修饰这种存储类型的，但它极少使用，因为代码块中的变量缺省情况下就是自动变量。在程序执行到声明自动变量的代码块时，自动变量才被创建，当程序的执行流离开代码块时，这些自动变量便自行销毁。在代码块内部声明的变量，如果给它加上static，可以使它的存储类型从自动变为静态。注意，修改变量的存储类型并不表示修改改变量的作用域。它任然只能在该代码块内部按名字访问。函数的形式参数不能声明为静态，因为实参总是在堆栈中传递给函数。</p>
<p><strong>这里和auto关键字进行区分，auto关键字一般用于自动判断变量或者返回值类型。</strong></p>
</li>
<li><p>关键字register(寄存器)可以用于自动变量的声明，提示它们应该存储于机器的硬件寄存器而不是内存中。</p>
</li>
</ol>
<p><strong>注意：</strong>静态变量未初始化会自动初始化为0，自动的不会并且初始化过程由链接器完成。</p>
<h2 id="全局变量和局部变量"><a href="#全局变量和局部变量" class="headerlink" title="全局变量和局部变量"></a><strong>全局变量和局部变量</strong></h2><ol>
<li>全局变量是定义在<strong>函数外部</strong>，通常是在程序的顶部。全局变量在整个程序生命周期内都是有效的，在任意的函数内部能访问全局变量。全局变量可以被任何函数访问。在程序中，局部变量和全局变量的名称可以相同，<strong>但是在函数内，如果两个名字相同，会使用局部变量值，全局变量不会被使用。</strong></li>
<li>在某个函数或块的内部声明的变量称为局部变量。它们只能被该函数或该代码块内部的语句使用。局部变量在函数外部是不可知的。</li>
<li>函数的参数，形式参数，被当作该函数内的局部变量，如果与全局变量同名它们会优先使用.</li>
</ol>
<table>
<thead>
<tr>
<th>变量类型</th>
<th>声明的位置</th>
<th>是否存在于堆栈</th>
<th>作用域</th>
<th>如果声明为static</th>
</tr>
</thead>
<tbody><tr>
<td>全局</td>
<td>所有代码块之外</td>
<td>否</td>
<td>从声明处到文件尾</td>
<td>不允许从其他源文件访问</td>
</tr>
<tr>
<td>局部</td>
<td>代码块起始处</td>
<td>是</td>
<td>整个代码块</td>
<td>变量不存储于堆栈中，它的值在程序整个执行期间一直保存</td>
</tr>
<tr>
<td>形式参数</td>
<td>函数头部</td>
<td>是</td>
<td>整个函数</td>
<td>不允许</td>
</tr>
</tbody></table>
<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><h3 id="external和internal以及none链接属性的讲解"><a href="#external和internal以及none链接属性的讲解" class="headerlink" title="external和internal以及none链接属性的讲解"></a>external和internal以及none链接属性的讲解</h3><p>1.链接属性分为external，internal，none。</p>
<p>2.全局变量默认拥有external链接属性；static修饰的变量拥有internal链接属性；函数体中的变量用于none链接属性。<br>3.拥有external链接属性的变量可被所有文件访问，只需要声明下即可(extern int b;)<br>拥有internal属性的变量只能在其定义的文件中被访问(static int sta_c;)<br>拥有none属性的变量只能在其定义开始处到代码块作用域结束处被访问。<br>4.给已经定义的变量添加任何链接属性声明(如:extern或static)都是无效的，变量原链接属性保持不变。<br><strong>用代码说明：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------myfun.c文件-------------------------------------------------------------</span><br><span class="line"><span class="keyword">int</span> b = <span class="number">123</span>; ①</span><br><span class="line"><span class="keyword">int</span> out_c = <span class="number">315</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">double</span> PI= <span class="number">3.14159</span>;  <span class="comment">//myfun.c文件以外的文件是不能访问PI变量的</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Add</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">-------------------------------test.c 文件----------------------------------------------------------------</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> ..  </span></span><br><span class="line"><span class="keyword">int</span> b;②   <span class="comment">//等价于extern int b;即定义在myfun.c中的变量b,最好写成extern int b;易于理解,这种简写模式只适用于全局作用域,对于函数作用域是不能简写的，否则成了定义函数的局部变量。</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">extern</span> <span class="keyword">int</span> b;③   <span class="comment">//external(外部链接)属性的b,其作用域起于此声明处止于语句④之前</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,b); <span class="comment">//输出：123</span></span><br><span class="line">    <span class="comment">//函数的局部变量，链接属性为none；④处的变量b会屏蔽掉③处的变量b，</span></span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">456</span>; ④</span><br><span class="line">    <span class="comment">//④处变量b的作用域起于其定义处，止于函数结束   </span></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,b);  <span class="comment">//输出： 456</span></span><br><span class="line">    <span class="keyword">extern</span> <span class="keyword">int</span> b;⑤ </span><br><span class="line">    <span class="comment">//编译器将extern int b解析成：在已经定义的int b = 456 (④)基础  </span></span><br><span class="line">    <span class="comment">//上加了一个extern属性。C规定：在已经定义变量上加任何链接属性都不  </span></span><br><span class="line">    <span class="comment">//会改变变量的原链接属性。给b上加extern属性并不会使none链接属性变成extern链接属性。</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,b);   <span class="comment">//所以输出： 456</span></span><br><span class="line">    <span class="keyword">extern</span> <span class="keyword">int</span> out_c;<span class="comment">//绝对不能简写成int out_c;否则是定义函数作用域的变量</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,out_c); <span class="comment">//输出：315</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/18/C%E5%92%8CC++/%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Erin-zw">
      <meta itemprop="description" content="来者犹可追">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Erin枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/18/C%E5%92%8CC++/%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">输入输出函数</a>
        </h2>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-18 20:54:36" itemprop="dateCreated datePublished" datetime="2023-06-18T20:54:36+08:00">2023-06-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-05 18:16:00" itemprop="dateModified" datetime="2023-09-05T18:16:00+08:00">2023-09-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="错误报告"><a href="#错误报告" class="headerlink" title="错误报告"></a>错误报告</h2><p>标准库函数在一个外部整型变量errno(在errno.h中定义)中保存错误代码之后把这个信息传给用户程序，提示操作失败的准确原因。</p>
<p>perror函数简化向用户报告这些错误的过程，函数原型定义于stdio.h：</p>
<p><code>void perror (char const *message);</code></p>
<p>如果messgae不是指向NULL并且指向一个非空字符串，就打印这个字符串，后面跟上一个分号和空格。</p>
<h2 id="终止执行"><a href="#终止执行" class="headerlink" title="终止执行"></a>终止执行</h2><p>另一个函数exit，定义于stdlib.h，函数原型如下：</p>
<p><code>void exit(int status);</code></p>
<p>status参数传给操作系统，用于提示程序是否正常完成，这个函数经常用于perror发现错误后用来终止程序。</p>
<h2 id="文本文件和二进制文件"><a href="#文本文件和二进制文件" class="headerlink" title="文本文件和二进制文件"></a>文本文件和二进制文件</h2><h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><p>计算机的存储在物理上是二进制的，所以文本文件与二进制文件的区别并不是<strong>物理</strong>上的，而是<strong>逻辑</strong>上的。这两者只是在<strong>编码层次</strong>上有差异。 </p>
<ul>
<li><p>文本文件是基于字符编码的文件，常见编码方式由ASCII，UNICODE等。文本文件一般是定长编码，如ASCII是8个比特代表一个字符。</p>
</li>
<li><p>二进制文件是基于值编码的文件。二进制文件是变长编码，多少比特一个值由你决定。</p>
</li>
</ul>
<p>以BMP文件为例，其头部是较为固定长度的文件头信息，前2字节用来记录文件为BMP格式，接下来的8个字节用来记录文件长度，再接下来的4字节用来 记录BMP文件头的长度，可以看出其编码是基于值的（不定长的，2、4、8字节长的值都有），所以BMP是二进制文件。 </p>
<h3 id="读取过程"><a href="#读取过程" class="headerlink" title="读取过程"></a>读取过程</h3><p>文本工具打开一个文件的过程是怎样的呢？拿记事本来说，它首先读取文件物理上所对应的二进制比特流（前面已经说了，存储都是二进制的），然后按照你所选择 的解码方式来解释这个流，然后将解释结果显示出来。一般来说，你选取的解码方式会是ASCII码形式（ASCII码的一个字符是８个比特），接下来，它8 个比特8个比特地来解释这个文件流。</p>
<p>例如对于这么一个文件流”01000000_01000001_01000010_01000011”(下划线 “_”，是我为了增强可读性，而手动添加的)，第一个8比特“01000000”按ASCII码来解码的话，所对应的字符是字符“A”，同理 其它3个8比特可分别解码为“BCD”，即这个文件流可解释成“ABCD”，然后记事本就将这个“ABCD”显示在屏幕上。</p>
<p>记事本无论打开什么文件都按既定的字符编码工作（如ASCII码），所以当他打开二进制文件出现乱码就很正常，解码和译码不对应嘛。例如文件流’’00000000_00000000_00000000_00000001’’可能在二进制文件中对应的是一个四字节的整数int 1，在记事本里解释就变成了”NULL_NULL_NULL_SOH”这四个控制符。</p>
<h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><p>一般认为，文本文件编码基于字符定长，译码容易些；二进制文件编码是变长的，所以它灵活，存储利用率要高些，译码难一些（不同的二进制文件格式，有不同的译码方式）。</p>
<p>很多书上还认为，文本文件的可读性要好些，存储要花费转换时间(读写要编译码)，而二进制文件可读性差，存储不存在转换时间（读写不要编解码，直接写值）。这里的可读性是从软件使用者角度来说的，因为我们用通用的记事本工具就几乎可以浏览所有文本文件，所以说文本文件可读性好；而读写一个具体的二进制 文件需要一个具体的文件解码器，所以说二进制文件可读性差，比如读BMP文件，必须用读图软件。而这里的存储转换时间应该是从编程的角度来说的，因为有些操作系统如windows需要对回车换行符进行转换(将’’&#x2F;n’’，换成’’&#x2F;r&#x2F;n’’），所以文件读写时，操作系统需要一个一个字符的检查。<br>当前字符是不是’’&#x2F;n’’或’’&#x2F;r&#x2F;n’’，这个在存储转换在Linux操作系统中并不需要，当然，当在两个不同的操作系统上共享文件时，这种存储 转换又可能出来(如Linux系统和Windows系统共享文本文件)。</p>
<h2 id="流"><a href="#流" class="headerlink" title="流"></a>流</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>C程序，所有I&#x2F;O操作只是简单地从程序移进或移出字节的事情，这种字节流就叫做流（stream）。</p>
<p>流是一个动态概念也是一个逻辑概念，是编程者和被访问的设备之间一层抽象的东西</p>
<p>C将数据的输入输出看作是数据的流入和流出，不管是磁盘文件或者是物理设备都可看作一种流的源和目的，视他们为同一种东西，而不管其具体的物理结构，即对他们的操作，就是数据的流入和流出。</p>
<p>绝大多数流是完全缓冲的，读取和写入实际上是从一块叫做缓冲区的内存区域来回复制数据。</p>
<h3 id="流的分类"><a href="#流的分类" class="headerlink" title="流的分类"></a>流的分类</h3><p>既然流是一种动态概念，流的基本单位就可以进行分类。</p>
<h4 id="文本流（字符流）"><a href="#文本流（字符流）" class="headerlink" title="文本流（字符流）"></a>文本流（字符流）</h4><p>文本流在不同系统中可能不同，比如说文本行最大长度，标准规定至少允许254个字符。另一个可能不同的就是文本行结束方式。例如Windows系统文本行以\r\n结尾，Unix以\n结尾。类似，在 Windows 平台上，文本流中的控制字符 ^Z（字符码 26），用来表示文本流的结束。并且在Windows系统中，输出时，文本中的换行符被写成一对回车&#x2F;换行符，输入时，每遇到一个回车&#x2F;换行就丢弃回车转化成换行，然后送到读缓冲区。</p>
<h4 id="二进制流（字节流）"><a href="#二进制流（字节流）" class="headerlink" title="二进制流（字节流）"></a>二进制流（字节流）</h4><p>二进制流读写时，其不存在任何转换，直接将写缓冲区中数据写入文件。</p>
<p>总的来说，从编程的角度来说，Ｃ中文本或二进制读写都是缓冲区与文件中二进制流的交互，只是文本读写时有回车换行的转换．所以当写缓冲区中无换行符”\n”(0AH)，文本写与二进制写的结果是一样的，同理，当文件中不存在“\r\n”(0DH0AH)时，文本读与二进制读的结果一样．</p>
<h2 id="缓冲区"><a href="#缓冲区" class="headerlink" title="缓冲区"></a>缓冲区</h2><h3 id="对缓冲区的理解"><a href="#对缓冲区的理解" class="headerlink" title="对缓冲区的理解"></a>对缓冲区的理解</h3><p>所谓缓冲区，应该就是系统自动分配的一个东西。所以有三者程序，缓冲区，文件（物理设备）。而所谓流（文件指针）就是记录了缓冲区的信息，以及文件的信息。</p>
<h3 id="缓冲区的必要性"><a href="#缓冲区的必要性" class="headerlink" title="缓冲区的必要性"></a>缓冲区的必要性</h3><p>比如我们从磁盘里取信息，我们先把读出的数据放在缓冲区，计算机再直接从缓冲区中取数据，等缓冲区的数据取完后再去磁盘中读取，这样就可以减少磁盘的读写次数，再加上计算机对缓冲区的操作大大快于对磁盘的操作，故应用缓冲区可大大提高计算机的运行速度。</p>
<p>又比如，我们使用打印机打印文档，由于打印机的打印速度相对较慢，我们先把文档输出到打印机相应的缓冲区，打印机再自行逐步打印，这时我们的CPU可以处理别的事情。</p>
<h3 id="缓冲区的类型"><a href="#缓冲区的类型" class="headerlink" title="缓冲区的类型"></a>缓冲区的类型</h3><ol>
<li><strong>全缓冲</strong>：在这种情况下，当 填满标准I&#x2F;O缓存后才进行实际I&#x2F;O操作。全缓冲的典型代表是对磁盘文件的读写 。</li>
<li><strong>行缓冲</strong>：在这种情况下，当在输入和输出中遇到换行符时，执行真正的I&#x2F;O操作。这时，我们输入的字符先存放在缓冲区，等按下回车键换行时才进行实际的I&#x2F;O操作。典型代表是标准输入(stdin) 和 标准输出(stdout) 。</li>
<li><strong>不带缓冲</strong>：也就是不进行缓冲，标准出错情况stderr是典型代表，这使得出错信息可以直接尽快地显示出来。</li>
</ol>
<h3 id="缓冲区的大小"><a href="#缓冲区的大小" class="headerlink" title="缓冲区的大小"></a>缓冲区的大小</h3><p>如果我们没有自己设置缓冲区的话，系统会默认为标准输入输出设置一个缓冲区，这个缓冲区的大小通常是 512个字节 的大小。</p>
<p>缓冲区大小由 stdio.h 头文件中的宏 BUFSIZ 定义，如果希望查看它的大小，包含头文件，直接输出它的值即可：printf(“%d”, BUFSIZ);</p>
<p>缓冲区的大小是可以改变的，也可以将文件关联到自定义的缓冲区，详情可以查看 setvbuf()和 setbuf() 函数。</p>
<h3 id="缓冲区的刷新（清空）"><a href="#缓冲区的刷新（清空）" class="headerlink" title="缓冲区的刷新（清空）"></a>缓冲区的刷新（清空）</h3><p>缓冲区的刷新就是将指针_ptr变为缓冲区的基地址﹐同时_cnt的值变为0，因为缓冲区刷新后里面是没有数据的!</p>
<p>下列情况会引发缓冲区的刷新：<br> 缓冲区满时 ； 行缓冲区遇到回车时 ； 关闭文件 ； 使用特定函数刷新缓冲区 。</p>
<h2 id="FILE结构体"><a href="#FILE结构体" class="headerlink" title="FILE结构体"></a>FILE结构体</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> STDIN_FILENO	0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> STDOUT_FILENO	1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> STDERR_FILENO	2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">iobuf</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">char</span>	*_ptr;<span class="comment">//指向缓冲区第一个未读的字</span></span><br><span class="line">  <span class="keyword">int</span>	 _cnt;<span class="comment">//剩余多少个字节还没有读/写</span></span><br><span class="line">  <span class="keyword">char</span>	*_base;<span class="comment">//缓冲区基地址</span></span><br><span class="line">  <span class="keyword">int</span>	 _flag;<span class="comment">//标志位，如是读（r）还是写（w），还可以是缓冲模式</span></span><br><span class="line">  <span class="keyword">int</span>	 _file;<span class="comment">//文件句柄</span></span><br><span class="line">  <span class="keyword">int</span>	 _charbuf<span class="comment">//单字节的缓冲，即缓冲大小仅为1个字节，如果为单字节缓冲，_base将无效  </span></span><br><span class="line">  <span class="keyword">int</span>	 _bufsiz;<span class="comment">//缓冲区大小，一般都是4096</span></span><br><span class="line">  <span class="keyword">char</span>	*_tmpfname;<span class="comment">//</span></span><br><span class="line">&#125; FILE;</span><br><span class="line"></span><br><span class="line">__MINGW_IMPORT FILE _iob[];	<span class="comment">/* An array of FILE imported from DLL. */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> stdin	(&amp;_iob[STDIN_FILENO])</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> stdout	(&amp;_iob[STDOUT_FILENO])</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> stderr	(&amp;_iob[STDERR_FILENO])</span></span><br></pre></td></tr></table></figure>

<p>上面代码摘取了stdio.h文件中关于FILE结构体的定义。FILE是一个数据结构，用于访问一个流，可以认为是辅助字节流动的一个结构。如果同时激活几个流，每个流都有一个FILE与他关联。可以看出标准输入流，标准输出流，标准错误流名称分别为stdin,stdout,stderr，都是指向FILE结构体的指针。标准输入是缺省情况下输入的来源，标准输出是缺省情况下输出的来源。通常标准输入为键盘设备，标准输出为屏幕或者终端。缺省的标准输入输出设备可以被修改。</p>
<p><strong>自己的理解：FILE结构体实际上就是一个文件缓冲区结构体，包含了缓冲区的信息，而所谓的流就是一个指向这种类型结构体的一个指针。实际上键盘输入什么的都是到了缓冲区。那文件输入呢，实际上打开一个文件fopen就是创建了一个内存区域作为缓冲区，函数返回了一个指向这个缓冲区的指针。</strong></p>
<h2 id="流I-x2F-O总览"><a href="#流I-x2F-O总览" class="headerlink" title="流I&#x2F;O总览"></a>流I&#x2F;O总览</h2><h3 id="文件I-x2F-O"><a href="#文件I-x2F-O" class="headerlink" title="文件I&#x2F;O"></a>文件I&#x2F;O</h3><ol>
<li>声明一个FILE指针变量，辅助字节流动</li>
<li>流通过fopen函数打开</li>
<li>根据需要对文件进行读写</li>
<li>调用fclose函数关闭流</li>
</ol>
<h3 id="标准I-x2F-O"><a href="#标准I-x2F-O" class="headerlink" title="标准I&#x2F;O"></a>标准I&#x2F;O</h3><p>不需要打开或者关闭</p>
<table>
<thead>
<tr>
<th>数据类型</th>
<th>输入</th>
<th>输出</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>字符</td>
<td>getchar</td>
<td>putchar</td>
<td>读取（写入）单个字符</td>
</tr>
<tr>
<td>文本行</td>
<td>gets&#x2F;scanf</td>
<td>puts&#x2F;printf</td>
<td>文本行未格式化的输入（输出）&#x2F;格式化的输入（输出）</td>
</tr>
<tr>
<td>二进制数据</td>
<td>fread</td>
<td>fwrite</td>
<td>读取（写入）二进制数据</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>家族名</th>
<th>目的</th>
<th>可用于所有流</th>
<th>只用于stdin和stdout</th>
<th>内存中的字符串</th>
</tr>
</thead>
<tbody><tr>
<td>getchar</td>
<td>字符输入</td>
<td>fgetc，getc</td>
<td>getchar</td>
<td>对指针下标引用或者间接访问</td>
</tr>
<tr>
<td>putchar</td>
<td>字符输出</td>
<td>fputc，putc</td>
<td>putchar</td>
<td>对指针下标引用或者间接访问</td>
</tr>
<tr>
<td>gets</td>
<td>文本行输入</td>
<td>fgets</td>
<td>gets</td>
<td>使用strcpy函数</td>
</tr>
<tr>
<td>puts</td>
<td>文本行输出</td>
<td>fputs</td>
<td>puts</td>
<td>使用strcpy函数</td>
</tr>
<tr>
<td>scanf</td>
<td>格式化输入</td>
<td>fscanf</td>
<td>scanf</td>
<td>sscanf</td>
</tr>
<tr>
<td>print</td>
<td>格式化输出</td>
<td>fprint</td>
<td>print</td>
<td>sprint</td>
</tr>
</tbody></table>
<h2 id="打开流"><a href="#打开流" class="headerlink" title="打开流"></a>打开流</h2><h3 id="fopen函数"><a href="#fopen函数" class="headerlink" title="fopen函数"></a>fopen函数</h3><p>fopen函数用于打开一个文件，并把一个流和这个文件关联，把所谓的流和文件绑定在一起。文件实际上可以看作一个物理设备，流就是文件这个物理设备和编程者之间的逻辑桥梁。</p>
<p>函数原型：</p>
<p><code>FILE *fopen(char const *name, char const *mode)</code></p>
<p>第一个参数是文件或者设备的名字，第二个参数值打开模式</p>
<p>模式如下：</p>
<table>
<thead>
<tr>
<th></th>
<th>读取</th>
<th>写入</th>
<th>添加</th>
</tr>
</thead>
<tbody><tr>
<td>文本</td>
<td>“r”</td>
<td>“w”</td>
<td>“a”</td>
</tr>
<tr>
<td>二进制</td>
<td>“rb”</td>
<td>“wb”</td>
<td>“ab”</td>
</tr>
</tbody></table>
<p>如果一个文件打开用于读取那么文件原先必须存在。如果被用来写入，文件如果存在，写入时原内容删除，如果文件不存在就新建一个。如果文件被用来添加，文件如果存在，写入时原内容不被删除，如果文件不存在就新建一个。无论哪一种情况，只能从<strong>文件尾部</strong>写入。</p>
<p>在添加模式下，流既可以读也可以写。如果已经读入了一些数据，那么你现在想写入数据，就必须调用文件定位函数。如果你先向文件写入数据之后又想读入数据，就要调用fflush函数或者文件定位函数。</p>
<p>如果fopen函数失败返回NULL指针。所以必须要检查函数的返回值。</p>
<p>fopen函数用法：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FILE *input;</span><br><span class="line">input = fopen(<span class="string">&quot;data3&quot;</span>,<span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(input == <span class="literal">NULL</span>)&#123;</span><br><span class="line">    perror(<span class="string">&quot;data3&quot;</span>);<span class="comment">//在屏幕打印：data3: No such file or directory</span></span><br><span class="line">    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="freopen函数"><a href="#freopen函数" class="headerlink" title="freopen函数"></a>freopen函数</h3><p>函数原型</p>
<p><code>FILE *freopen(char const *filename,char const *mode,FILE *name);</code></p>
<p>这个函数用途就是将一个流重定向到其他文件或者物理设备。</p>
<p>举个例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* args[])</span></span>&#123;</span><br><span class="line">   freopen (<span class="string">&quot;b.txt&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="built_in">stdout</span>);<span class="comment">//此处mode可以选择w或者a，选择r无效</span></span><br><span class="line">   <span class="built_in">puts</span>(<span class="string">&quot;nmsl&quot;</span>);</span><br><span class="line">   getchar();</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>标准输出流stdout默认的关联输出设备是屏幕即终端，使用freopen函数后stdout就会重定向到b.txt文件，之后输出的字符都会到这个文件中。</p>
<h2 id="关闭流"><a href="#关闭流" class="headerlink" title="关闭流"></a>关闭流</h2><p>流是用fclose函数关闭的，函数原型如下:<code>int flcose(FILE *f);</code></p>
<p>对于输出流，fclose函数在文件关闭之前刷新缓冲区，如果执行成功返回零值，否则返回EOF</p>
<p>关闭时要进行错误检查：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(fclose(xx)!=<span class="number">0</span>)&#123;</span><br><span class="line">    perror(<span class="string">&quot;fclose&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="字符I-x2F-O"><a href="#字符I-x2F-O" class="headerlink" title="字符I&#x2F;O"></a>字符I&#x2F;O</h2><h3 id="字符I-x2F-O宏和函数"><a href="#字符I-x2F-O宏和函数" class="headerlink" title="字符I&#x2F;O宏和函数"></a>字符I&#x2F;O宏和函数</h3><p>当一个流被打开，可以用于输入也可以用于输出，最简单的形式就是字符I&#x2F;O。</p>
<p>字符输入函数原型：</p>
<p><code>int fgetc(FILE *stream)</code></p>
<p><code>int getc(FILE *stream)</code></p>
<p><code>int getchar(void)</code>始终从标准输入读取</p>
<p>fgetc和getc区别就是，fgetc是一个函数，getc是一个宏</p>
<p>这些函数之所以返回int型而不是char是因为必须有一个字符用来表示EOF，所以EOF被定义为一个整型，它的值在任何可能出现的字符范围之外。</p>
<p>字符输出函数原型：</p>
<p><code>int fputc(int character, FILE *stream);</code></p>
<p><code>int putc(int character, FILE *stream);</code></p>
<p><code>int putchar(int character);</code></p>
<p>由于任何一个原因函数失败了则返回EOF</p>
<p><strong>使用注意点：</strong></p>
<ul>
<li>getc的参数不应当是具有副作用的表达式。有副作用的表达式，指的是表达式执行后，会改变表达式中某些变量的值。比如++i * ++i。这里就是所谓的宏的注意点。函数不会造成这种影响。</li>
<li>因为fgetc一定是一个函数，所以可以得到其地址。这就允许将fgetc的地址作为一个参数传送给另一个函数即函数指针。</li>
<li>调用fgetc所需时间很可能长于调用getc，因为调用函数通常所需的时间长于调用宏。</li>
</ul>
<h3 id="撤销字符I-x2F-O"><a href="#撤销字符I-x2F-O" class="headerlink" title="撤销字符I&#x2F;O"></a>撤销字符I&#x2F;O</h3><p>如果你想从一个流中读取一串数字，你必须连续读取直到遇到一个非数字字符，但是你不希望丢弃这个字符，希望下一次开始读取的时候还能读取这个字符，就可以用到ungetc函数，函数原型如下：</p>
<p><code>int ungetc(int character, FILE *stream);</code></p>
<p>ungetc函数把一个字符重新返回到流中，这样他就可以被重新读入。</p>
<p>例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read_int</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value;</span><br><span class="line">    <span class="keyword">int</span> ch;</span><br><span class="line">    value = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>((ch = getchar()) != EOF &amp;&amp; <span class="built_in">isdigit</span>(ch))&#123;</span><br><span class="line">        value *= <span class="number">10</span>;</span><br><span class="line">        value += ch - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ungetc(ch,<span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* args[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    a = read_int();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="未格式化的行I-x2F-O"><a href="#未格式化的行I-x2F-O" class="headerlink" title="未格式化的行I&#x2F;O"></a>未格式化的行I&#x2F;O</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>行I&#x2F;O可用两种方式执行：格式化的和未格式化的。这两种都用于操纵字符串。</p>
<p>读取函数原型：</p>
<p><code>char *fgets(char *buffer, int buffer_size, FILE *stream);</code></p>
<p><code>char *gets(char *buffer);</code></p>
<p>fgets函数从指定的流中读取字符并把它们复制到数组buffer中，当他读取一个换行符并存储到数组时就不再读取。如果缓冲区字符数达到buffer_size-1时也停止读取。这种情况下，并不会字符丢失，<strong>因为下一次调用fgets将从流的下一个字符开始读取</strong>。在任何一种情况下，一个NUL字符被添加到数组所存储的数据末尾，使其成为一个字符串。</p>
<p>如果fgets函数在任何字符读取前就达到了文件尾，数组就未进行修改，返回一个NULL指针，否则返回指向数组的指针。</p>
<p>写入函数原型：</p>
<p><code>int fputs(char const *buffer, FILE *stream);</code></p>
<p><code>int puts(char const *buffer);</code></p>
<p>传送给fputs的数组必须包含一个字符串，他的字符被写入流中，这个字符串预期以NUL结尾，所以没有数组（字符串）长度参数。fgets每次只能最多读取一行，fputs可以输出一行的一部分，也可以一次写入一行，也可以一次写入多行，根据字符串中换行符的个数决定。如果写入出现错误返回EOF，否则返回一个非负值。</p>
<p>来看一个从一个文件向另一个文件复制文本行的例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LINE_LENGTH 1024<span class="comment">//我可以复制的最长行</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">copylines</span><span class="params">( FILE *input, FILE *output )</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buffer[MAX_LINE_LENGTH];</span><br><span class="line">    <span class="keyword">while</span>( fgets( buffer, MAX_LINE_LENGTH, input) != <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">fputs</span>( buffer, putput);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MAX_LINE_LENGTH决定了数组最大长度，也就是一行的最大长度.这个长度不是很重要,因为不管行被一次性读取还是分段读取,产生的文件都是相同的.但是如果函数要统计被复制的行数,就不能简单地在循环里变量加加,而是要加上判断每段是否以换行符结尾.</p>
<h3 id="关于fgets和gets-fputs和puts的区别"><a href="#关于fgets和gets-fputs和puts的区别" class="headerlink" title="关于fgets和gets,fputs和puts的区别:"></a>关于fgets和gets,fputs和puts的区别:</h3><ul>
<li>gets读取一行输入时,读取到\n时结束,系统自动将\n转换成NUL，所以实际上是可以无限读入的</li>
<li>puts写入一个字符串时,他在字符串写入之后向输出在添加一个换行符(这个换行在windows输出被添加一个回车,变成回车换行).这就是为什么puts可以自动换行.</li>
<li>gets函数没有数组长度等参数,如果一个长输入行被读到一个短的缓冲区,多出来的字符将被写入到指定数组后面的内存位置,这将破坏一个或多个不相关变量的值.所以gets只适用于玩具程序,因为唯一防止数组内存溢出的方法就是声明一个巨大的缓冲区,但不管他有多大,下一个输入行有可能仍可能比缓冲区大.而fgets并不会出现溢出.</li>
</ul>
<p><strong>例子：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 5</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> s1[N];</span><br><span class="line">    <span class="keyword">char</span> s2[N];</span><br><span class="line">    fgets(s1, N, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="comment">//    gets(s1);</span></span><br><span class="line">    <span class="keyword">if</span>(s1[<span class="built_in">strlen</span>(s1) - <span class="number">1</span>] == <span class="string">&#x27;\n&#x27;</span>)&#123;        <span class="comment">// 去掉换行符</span></span><br><span class="line">        s1[<span class="built_in">strlen</span>(s1) - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//   fflush(stdin);                               //清空缓冲区</span></span><br><span class="line">    fgets(s2, N, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="comment">//    gets(s2);</span></span><br><span class="line">    <span class="keyword">if</span>(s2[<span class="built_in">strlen</span>(s2) - <span class="number">1</span>] == <span class="string">&#x27;\n&#x27;</span>)&#123;        <span class="comment">// 去掉换行符</span></span><br><span class="line">        s2[<span class="built_in">strlen</span>(s2) - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s %s\n&quot;</span>, s1, s2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>当使用fgets函数输入时，如果输入12345，则输出1234 5.s1就是”1234\0“，s2就是”5\0“。为什么会这样就是说fgets函数因为数组长度原因而造成读取完毕时，下一个fgets会继续读取缓冲区的字符。</p>
</li>
<li><p>当使用gets函数时，可以无限读取，所以要进行两次输入，但是如果超过了数组长度，内存溢出。如果输入123456（回车）abcdef（回车），就会输出f abcdef。这是因为内存溢出，实际上在内存中排列如下：</p>
<p>当s1输入完毕时：<img src="/images/C/输入输出函数/1.jpg" style="zoom: 50%;"></p>
<p>当s2输入完毕时：<img src="/images/C/输入输出函数/2.jpg" style="zoom: 50%;"></p>
</li>
</ul>
<h2 id="格式化的行I-x2F-O（scanf家族）"><a href="#格式化的行I-x2F-O（scanf家族）" class="headerlink" title="格式化的行I&#x2F;O（scanf家族）"></a>格式化的行I&#x2F;O（scanf家族）</h2><h3 id="函数原型"><a href="#函数原型" class="headerlink" title="函数原型"></a>函数原型</h3><p><code>int fscanf(FILE *stream, char const *format, ...);</code></p>
<p><code>int scanf(char const *format, ...);</code></p>
<p><code>int sscanf(char const *string, char const *format, ...);</code></p>
<p>每一个省略号表示一个可变长的的指针列表。这些函数根据输入源读取字符串并根据format字符串给出的格式代码对他们进行转换。</p>
<p>fscanf输入源就是作为参数给出的流，scanf输入源是标准输入流，sscanf输入源是字符串。</p>
<p>当格式化字符串到达末尾时或者读取的输入不再匹配格式字符串所指定的类型时，输入停止。返回值都是被转换的输入值的数目，如果在任何输入值被转换之前文件就到达了尾部返回EOF。</p>
<h3 id="格式代码"><a href="#格式代码" class="headerlink" title="格式代码"></a>格式代码</h3><p>format字符串可能包含以下：</p>
<h4 id="空白字符"><a href="#空白字符" class="headerlink" title="空白字符"></a>空白字符</h4><p>如换行符，空格等，函数连续读入字符直到遇到空白字符。</p>
<h4 id="其他字符"><a href="#其他字符" class="headerlink" title="其他字符"></a>其他字符</h4><p>出现其他字符时，输入必须匹配，匹配后的输入随即被丢弃，如果不匹配就不再读取直接返回。比如<code>scanf(&quot;3%d&quot;,&amp;c);</code>输入必须要先输入一个3才能就需输入你要的。</p>
<h4 id="格式代码-1"><a href="#格式代码-1" class="headerlink" title="格式代码"></a>格式代码</h4><p>他们指定函数如何解释接下来的输入字符。一般以一个百分号开头，后面可以是</p>
<ul>
<li><p>一个可选星号，星号将转换后的值丢弃而不是存储</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c,d;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%*d %d&quot;</span>,&amp;c,&amp;d);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d %d&quot;</span>,c,d);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输入1 2 输出 2 0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>一个可选的宽度，限制被读取用于转换的输入字符个数。如果没有给出宽度，函数就连续读入字符直到遇到空白字符。</p>
</li>
<li><p>一个可选限定符</p>
<table>
<thead>
<tr>
<th>格式码</th>
<th>h</th>
<th>l</th>
<th>L</th>
</tr>
</thead>
<tbody><tr>
<td>d,i,n</td>
<td>short</td>
<td>long</td>
<td></td>
</tr>
<tr>
<td>o,u,x</td>
<td>unsigned</td>
<td>unsigned long</td>
<td></td>
</tr>
<tr>
<td>e,f,g</td>
<td></td>
<td>double</td>
<td>long double</td>
</tr>
</tbody></table>
</li>
<li><p>格式代码（自己查阅）</p>
</li>
</ul>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>在使用fscanf时，在输入中保持边界的同步是困难的，因为他把换行符也当作空白字符跳过。</p>
<p>比如一组数据想要四个一输入，但是如果第二行是出错了，第三次输入数据就会变成2 3 3 3，就会无法边界同步。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 1 1 1</span><br><span class="line">2 2 2 2 2</span><br><span class="line">3 3 3 3</span><br><span class="line">4 4 4 4</span><br><span class="line">5 5 5 5</span><br></pre></td></tr></table></figure>

<p>办法就是使用sscanf处理行定向的输入：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE 100<span class="comment">//要处理的最长行</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">function</span><span class="params">( FILE *input )</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a, b, c, d, e;</span><br><span class="line">    <span class="keyword">char</span> str[SIZE];</span><br><span class="line">    <span class="keyword">while</span>( fgets( str, SIZE, input ) != <span class="literal">NULL</span> )&#123;</span><br><span class="line">        <span class="keyword">if</span>( <span class="built_in">sscanf</span>( str, <span class="string">&quot;%d %d %d %d %d&quot;</span>, &amp;a， &amp;b, &amp;c, &amp;d, &amp;e) != <span class="number">4</span>)&#123;</span><br><span class="line">            fprint( <span class="built_in">stderr</span>, <span class="string">&quot;Bad input skipped: %s&quot;</span>, str);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//处理这组输入</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="格式化的行I-x2F-O（printf家族）"><a href="#格式化的行I-x2F-O（printf家族）" class="headerlink" title="格式化的行I&#x2F;O（printf家族）"></a>格式化的行I&#x2F;O（printf家族）</h2><h3 id="函数原型-1"><a href="#函数原型-1" class="headerlink" title="函数原型"></a>函数原型</h3><p><code>int fprintf( FILE *stream, char const *format, ... );</code></p>
<p><code>int printf( char const *format, ... );</code></p>
<p>&#96;&#96;int sprintf( char *buffer, char const *format, … );&#96;</p>
<p>3个函数返回值是实际打印或存储的字符数。避免sprintf数组内存溢出。</p>
<h3 id="格式代码-2"><a href="#格式代码-2" class="headerlink" title="格式代码"></a>格式代码</h3><p>除了格式代码，其他字符原样打印，格式代码一般百分号开头，后面可以跟：</p>
<h4 id="零个或多个标志字符"><a href="#零个或多个标志字符" class="headerlink" title="零个或多个标志字符"></a>零个或多个标志字符</h4><table>
<thead>
<tr>
<th>标志</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-</td>
<td>值在字段中左对齐，缺省情况是右对齐</td>
</tr>
<tr>
<td>0</td>
<td>当数值右对齐时，缺省情况用空格填充左边未使用的列。这个标志表示用0填充，他可用于d,i,o,u,x,X,e,E,f,g,G代码，使用d,i,o,u,X,x代码时，如果给出精度字段，零标志被忽略，如果代码中出现负号标志，零标志也无效。</td>
</tr>
<tr>
<td>+</td>
<td>缺省状态下一个非负值并不正号，正号标志给非负值加上正号</td>
</tr>
<tr>
<td>空格</td>
<td>如果一个值非负，那么就在这个值开始位置加上一个空格，如果和正号标志同时出现，忽略空格。</td>
</tr>
<tr>
<td>#</td>
<td>选择某些代码的另一种转换形式</td>
</tr>
</tbody></table>
<h4 id="一个可选的最小字段宽度"><a href="#一个可选的最小字段宽度" class="headerlink" title="一个可选的最小字段宽度"></a>一个可选的最小字段宽度</h4><p>指定结果最小字符数，值的字符数大于指定值正常显示，小于的话根据标志显示。</p>
<h4 id="一个可选的精度"><a href="#一个可选的精度" class="headerlink" title="一个可选的精度"></a>一个可选的精度</h4><p>看书</p>
<h4 id="一个可选的修改符"><a href="#一个可选的修改符" class="headerlink" title="一个可选的修改符"></a>一个可选的修改符</h4><table>
<thead>
<tr>
<th>修改符</th>
<th>用于···时</th>
<th>表示参数是···</th>
</tr>
</thead>
<tbody><tr>
<td>h</td>
<td>d,i,o,u,x,X</td>
<td>一个（可能是无符号）short型整数</td>
</tr>
<tr>
<td>h</td>
<td>n</td>
<td>一个指向short型整数的指针</td>
</tr>
<tr>
<td>l</td>
<td>d,i,o,u,x,X</td>
<td>一个（可能是无符号）long型整数</td>
</tr>
<tr>
<td>l</td>
<td>n</td>
<td>一个指向long型整数的指针</td>
</tr>
<tr>
<td>L</td>
<td>e,E,g,f,G</td>
<td>一个long double型值</td>
</tr>
</tbody></table>
<h4 id="转换类型"><a href="#转换类型" class="headerlink" title="转换类型"></a>转换类型</h4><p>和scanf差不多</p>
<h2 id="二进制I-x2F-O"><a href="#二进制I-x2F-O" class="headerlink" title="二进制I&#x2F;O"></a>二进制I&#x2F;O</h2><p>数据写到文件效率最高的就是二进制写入，二进制避免了字符转换的开销和精度。但是可读性太差，需要特定程序读取。</p>
<h3 id="函数原型-2"><a href="#函数原型-2" class="headerlink" title="函数原型"></a>函数原型</h3><p><code>size_t fread( void *buffer, size_t size, size_t count, FILE *stream );</code></p>
<p><code>size_t fwrite( void *buffer, size_t size, size_t count, FILE *stream );</code></p>
<p>buffer是一个指向保存数据位置的指针，size是一个元素所占用的字节，count是元素个数，stream就是流。</p>
<h3 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">VALUE</span> &#123;</span></span><br><span class="line">    <span class="keyword">long</span> a;</span><br><span class="line">    <span class="keyword">float</span> b;</span><br><span class="line">    <span class="keyword">char</span> c[SIZE];</span><br><span class="line">&#125; vlaue[ARRAY_SIZE];</span><br><span class="line">n_values = fread( values, <span class="keyword">sizeof</span>( struct VALUE ), ARRAY_SIZE, input_stream );</span><br><span class="line"><span class="comment">/*处理数据...*/</span></span><br><span class="line">fwrite( values, <span class="keyword">sizeof</span>( struct VALUE ), ARRAY_SIZE, output_stream );</span><br></pre></td></tr></table></figure>

<h2 id="刷新和定位函数"><a href="#刷新和定位函数" class="headerlink" title="刷新和定位函数"></a>刷新和定位函数</h2><h3 id="刷新函数"><a href="#刷新函数" class="headerlink" title="刷新函数"></a>刷新函数</h3><h4 id="函数原型-3"><a href="#函数原型-3" class="headerlink" title="函数原型"></a>函数原型</h4><p><code>int fflush( FILE *strream );</code></p>
<p>立即把输出缓冲区信息打印，或者把输入缓冲区信息丢弃。</p>
<h3 id="定位函数"><a href="#定位函数" class="headerlink" title="定位函数"></a>定位函数</h3><h4 id="函数原型-4"><a href="#函数原型-4" class="headerlink" title="函数原型"></a>函数原型</h4><p><code>long ftell( FILE *stream );</code></p>
<p><code>int fseek( FILE *stream, long offset, int from );</code></p>
<h4 id="ftell函数"><a href="#ftell函数" class="headerlink" title="ftell函数"></a>ftell函数</h4><p>ftell函数返回流的当前位置，下一个读取或者吸入将要开始的位置距离文件起始位置的偏移量。</p>
<p>在二进制流中，这个值就是当前位置距离文件起止位置的字节数。</p>
<p>在文本流中，这个值表示一个位置，他不一定表示当前位置与文件起始位置之间的字符数，因为有转义字符，但是ftell函数返回值总能用于fseek函数中，作为距离文件起始位置的偏移量。</p>
<h4 id="fseek函数"><a href="#fseek函数" class="headerlink" title="fseek函数"></a>fseek函数</h4><p>函数允许你在一个流中定位，这个操作将改变下一个读取或写入的位置。第二个参数是偏移量，第三个参数是属性见下表：</p>
<table>
<thead>
<tr>
<th>from</th>
<th>你将定位到</th>
</tr>
</thead>
<tbody><tr>
<td>SEEK_SET</td>
<td>从流的起始位置起offset个字节，offset必须是一个非负值</td>
</tr>
<tr>
<td>SEEK_CUR</td>
<td>从流的当前位置起offset个字节，offset可正可负</td>
</tr>
<tr>
<td>SEEK_END</td>
<td>从流的尾部位置起offset个字节，offset可正可负，如果为正将定位到文件尾后</td>
</tr>
</tbody></table>
<p>试图定位到一个文件开始位置之前是错误的，定位到文件尾是扩展这个文件。</p>
<p>在二进制流中，从SEEK_END进行定位可能不被支持。在文本流中，如果是SEEK_CUR或者SEEK_END，offset必须是0.如果是SEEK_SET，offset必须是一个从同一个流ftell返回的值。</p>
<h2 id="改变缓冲方式"><a href="#改变缓冲方式" class="headerlink" title="改变缓冲方式"></a>改变缓冲方式</h2><h3 id="函数原型-5"><a href="#函数原型-5" class="headerlink" title="函数原型"></a>函数原型</h3><p><code>void setbuf( FIEL *stream, char *buf );</code></p>
<p><code>int setvbuf( FILE *stream, char *buf, int mode, size_t size );</code></p>
<p>setbuf设定一个数组用于对流进行缓冲，实际上就是不使用系统默认分配的缓冲区，重新给流分配一个数组作为缓冲区。这个数组大小必须是BUFSIZE，如果函数参数是NULL，setbuf将关闭所有流的缓冲方式。避免为流分配自动数组。</p>
<p>setvbuf更为通用，mode指定缓冲类型，buf和size指定了缓冲区。</p>
<h2 id="流错误函数"><a href="#流错误函数" class="headerlink" title="流错误函数"></a>流错误函数</h2><h3 id="函数原型-6"><a href="#函数原型-6" class="headerlink" title="函数原型"></a>函数原型</h3><p><code>int feof( FILE *stream );</code></p>
<p><code>int ferror( FILE *stream );</code></p>
<p><code>void clearerror( FILE *stream );</code></p>
<p>如果流位于文件尾，feof为真。ferror报告流的错误状态。如果任何读写函数出现错误为真。clearerror对指定流的错误标志进行重置。</p>
<h2 id="临时文件"><a href="#临时文件" class="headerlink" title="临时文件"></a>临时文件</h2><h3 id="函数原型-7"><a href="#函数原型-7" class="headerlink" title="函数原型"></a>函数原型</h3><p><code>FILE *tmpfile( void );</code></p>
<p>这个函数创建一个文件保存临时数据，当程序结束被自动删除。该文件以wb+模式打开，可以保存二进制和文本文件。</p>
<p><code>char *tmpnam( char *name );</code></p>
<p>创建临时文件名字</p>
<h2 id="文件操纵函数"><a href="#文件操纵函数" class="headerlink" title="文件操纵函数"></a>文件操纵函数</h2><h3 id="函数原型-8"><a href="#函数原型-8" class="headerlink" title="函数原型"></a>函数原型</h3><p><code>int remove( char const *filename );</code></p>
<p><code>int rename(char const *oldname, char const *newname );</code></p>

      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/18/C%E5%92%8CC++/%E8%81%94%E5%90%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Erin-zw">
      <meta itemprop="description" content="来者犹可追">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Erin枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/18/C%E5%92%8CC++/%E8%81%94%E5%90%88/" class="post-title-link" itemprop="url">联合</a>
        </h2>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-18 20:54:36" itemprop="dateCreated datePublished" datetime="2023-06-18T20:54:36+08:00">2023-06-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-05 18:15:30" itemprop="dateModified" datetime="2023-09-05T18:15:30+08:00">2023-09-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>694</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>最简单的使用联合例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">   <span class="keyword">float</span> f;</span><br><span class="line">   <span class="keyword">int</span> i;</span><br><span class="line">&#125;fi;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   fi.f = <span class="number">1.5</span>;</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,fi.i);</span><br><span class="line">   system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的联合在一个整形和浮点都是32位的机器上，变量fi只占用一个32位的字，若成员f被使用，这个字作为浮点值访问，成员i若被使用，这个字作为整形被访问。也就说<strong>联合中所有成员引用的是内存中相同的位置</strong>。</p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">VARIBLE</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> &#123;</span>INT,FLOAT,STRING&#125; type;</span><br><span class="line">    <span class="keyword">int</span> int_value;</span><br><span class="line">    <span class="keyword">float</span> float_value;</span><br><span class="line">    <span class="keyword">char</span> *string_value;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//使用union</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">VARIBLE</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> &#123;</span>INT,FLOAT,STRING&#125; type;</span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> i;</span><br><span class="line">        <span class="keyword">float</span> f;</span><br><span class="line">        <span class="keyword">char</span> *s;</span><br><span class="line">    &#125;value;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>有一个结构保存变量的类型和值。如果是int型，那么就有两个没有被使用。使用联合可以避免。从而节省了内存空间。</p>
<p><strong>联合的长度取决于最长成员的长度。</strong>当联合中成员长度相差较为悬殊时，内存就会浪费，这时存储指针可以避免浪费内存。</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">float</span> b;</span><br><span class="line">    <span class="keyword">char</span> c[<span class="number">4</span>];</span><br><span class="line">&#125;x = &#123;<span class="number">5</span>&#125;;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/18/C%E5%92%8CC++/%E7%BB%93%E6%9E%84%E4%BD%93%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Erin-zw">
      <meta itemprop="description" content="来者犹可追">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Erin枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/18/C%E5%92%8CC++/%E7%BB%93%E6%9E%84%E4%BD%93%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">结构体基础</a>
        </h2>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-18 20:54:36" itemprop="dateCreated datePublished" datetime="2023-06-18T20:54:36+08:00">2023-06-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-05 18:15:24" itemprop="dateModified" datetime="2023-09-05T18:15:24+08:00">2023-09-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>结构是一些值的集合，这些值称为它的<strong>成员</strong>。结构变量属于标量类型。</p>
<h3 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h3><p><strong>声明格式：</strong></p>
<p><code>struct tag&#123;member-list&#125;  variable-list;</code></p>
<p><strong>例子1：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">char</span> b;</span><br><span class="line">    <span class="keyword">float</span> c;</span><br><span class="line">&#125;x;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">char</span> b;</span><br><span class="line">    <span class="keyword">float</span> c;</span><br><span class="line">&#125;y[<span class="number">20</span>],*z;</span><br></pre></td></tr></table></figure>

<p>声明了一个叫x的变量，有三个成员变量，整数a，字符b，浮点数c。</p>
<p>声明了y数组，包含了20个结构。</p>
<p>声明了z指针，指向结构体的指针。</p>
<p>综上所述，<strong>不严谨的可以把结构体当作一种新类型对比整型</strong>。</p>
<p>下列语句是非法的，因为这两种声明被编译器当作两种类型，所以y，x，z类型不同，不能进行赋值。</p>
<p><code>z = &amp;x;</code></p>
<p>如何处理上述问题，看看例子2：</p>
<p><strong>例子2：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SIMPLE</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">char</span> b;</span><br><span class="line">    <span class="keyword">float</span> c;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SIMPLE</span> <span class="title">x</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SIMPLE</span> <span class="title">y</span>[20],*<span class="title">z</span>;</span></span><br></pre></td></tr></table></figure>

<p>标签tag为成员列表提供一个名字，以便后续声明。标签允许多个声明使用同一个成员列表。并且此时x，y，z三者属于同一种类型。</p>
<p><strong>例子3：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">char</span> b;</span><br><span class="line">    <span class="keyword">float</span> c;</span><br><span class="line">&#125;Simple;</span><br><span class="line">Simple x;</span><br><span class="line">Simple y[<span class="number">20</span>],*z;</span><br></pre></td></tr></table></figure>

<p>使用typedef重新定义一种新类型是一种声明结构体的好方法。这个技巧和声明一个结构标签的效果几乎相同，区别在于Simple现在是个类型名，而SIMPLE是个结构标签。</p>
<h3 id="间接访问与直接访问"><a href="#间接访问与直接访问" class="headerlink" title="间接访问与直接访问"></a>间接访问与直接访问</h3><p><strong>例子：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//声明</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">COMPLEX</span>&#123;</span></span><br><span class="line">    <span class="keyword">float</span> f;</span><br><span class="line">    <span class="keyword">int</span> a[<span class="number">20</span>];</span><br><span class="line">    <span class="keyword">long</span> *lp;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">SIMPLE</span> <span class="title">s</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">SIMPLE</span> <span class="title">sa</span>[10];</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">SIMPLE</span> *<span class="title">sp</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">COMPLEX</span> <span class="title">comp</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">COMPLEX</span> *<span class="title">cp</span>;</span></span><br><span class="line"><span class="comment">//直接访问</span></span><br><span class="line">comp.f</span><br><span class="line">comp.sa[<span class="number">4</span>].c</span><br><span class="line"><span class="comment">//间接访问</span></span><br><span class="line">cp-&gt;f</span><br><span class="line">cp-&gt;a</span><br></pre></td></tr></table></figure>

<h3 id="结构体的自引用与互引用"><a href="#结构体的自引用与互引用" class="headerlink" title="结构体的自引用与互引用"></a>结构体的自引用与互引用</h3><h4 id="自引用"><a href="#自引用" class="headerlink" title="自引用"></a>自引用</h4><p>结构体内部包含结构体本身是非法的，可以包含只想结构体本身的指针。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tag</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tag</span> *<span class="title">b</span>;</span></span><br><span class="line">    <span class="keyword">int</span> c;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>下面是错误定义，因为在struct内部时name尚未被定义</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    name *b;</span><br><span class="line">    <span class="keyword">int</span> c;</span><br><span class="line">&#125;name;</span><br></pre></td></tr></table></figure>

<p>解决方法就是定义一个结构标签声明b。</p>
<p>正确定义：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">name_tag</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">name_tag</span> *<span class="title">b</span>;</span></span><br><span class="line">    <span class="keyword">int</span> c;</span><br><span class="line">&#125;name;</span><br></pre></td></tr></table></figure>

<p><strong>实例：</strong></p>
<p>二叉树结点：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">binary_tree</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> data    ;   <span class="comment">// Data area</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">binary_tree</span> * <span class="title">left</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">binary_tree</span> * <span class="title">right</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="互引用和不完整声明"><a href="#互引用和不完整声明" class="headerlink" title="互引用和不完整声明"></a>互引用和不完整声明</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span>;</span><span class="comment">//不完整声明</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">B</span> *<span class="title">partner</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">A</span> *<span class="title">partner</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>使用不完整声明，声明一个作为结构标签的标识符，然后就可以用在不需要知道这个结构长度的声明中，比如声明指向这个结构的指针。</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">INIT_EX</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">short</span> b[<span class="number">10</span>];</span><br><span class="line">    Simple c;</span><br><span class="line">&#125;x = &#123;</span><br><span class="line">    <span class="number">10</span>,</span><br><span class="line">    &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;,</span><br><span class="line">    &#123;<span class="number">25</span>,<span class="string">&#x27;x&#x27;</span>,<span class="number">1.9</span>&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/18/C%E5%92%8CC++/%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8C%E6%8C%87%E9%92%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Erin-zw">
      <meta itemprop="description" content="来者犹可追">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Erin枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/18/C%E5%92%8CC++/%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8C%E6%8C%87%E9%92%88/" class="post-title-link" itemprop="url">结构体和指针</a>
        </h2>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-18 20:54:36" itemprop="dateCreated datePublished" datetime="2023-06-18T20:54:36+08:00">2023-06-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-05 18:15:19" itemprop="dateModified" datetime="2023-09-05T18:15:19+08:00">2023-09-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>889</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="结构体和指针"><a href="#结构体和指针" class="headerlink" title="结构体和指针"></a>结构体和指针</h2><h3 id="指针引用"><a href="#指针引用" class="headerlink" title="指针引用"></a>指针引用</h3><p><strong>例子：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">short</span> b[<span class="number">2</span>];</span><br><span class="line">&#125;Ex2;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">EX</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">char</span> b[<span class="number">3</span>];</span><br><span class="line">    Ex2 c;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">EX</span> *<span class="title">d</span>;</span></span><br><span class="line">&#125;Ex;</span><br><span class="line">Ex x = &#123;<span class="number">10</span>,<span class="string">&quot;Hi&quot;</span>,&#123;<span class="number">5</span>,&#123;<span class="number">-1</span>,<span class="number">25</span>&#125;&#125;,<span class="number">0</span>&#125;;</span><br><span class="line">Ex *px = &amp;x;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>*px+1是非法的，C语言并没有定义结构和整型值之间的加法运算。*(px+1)也是非法的，如果x是数组中的一个元素则是指向数组中的下一个结构，但是这里x是一个标量，所以是非法的。</p>
</li>
<li><p>对比分析*px和px-&gt;a。结构的第一个成员是a，a的地址和结构体的地址是一样的。这样px看上去指向整个结构，同时指向结构的第一个成员。但是两者类型不一样，px被声明为指向结构的指针，所以*px指向的是整个结构体，而不是第一个成员。</p>
</li>
<li><p>px-&gt;c.a表示c结构体中的a成员。*px-&gt;c.b表示b数组第一个元素。</p>
</li>
</ul>
<h2 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h2><p>创建如下结构体：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> a;</span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line">    <span class="keyword">float</span> c;</span><br><span class="line">    <span class="keyword">float</span> d;</span><br><span class="line">&#125;Transcation;</span><br></pre></td></tr></table></figure>

<p><strong>方法一：</strong>若要创建修改其中d的值的函数，可以直接传递结构体。但是结构体先被拷贝作为参数传递给函数修改，然后一份修改后的结构体拷贝从函数返回，所以结构体被复制了两次效率较低。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//是一个返回结构体的函数</span></span><br><span class="line"><span class="function">Transaction</span></span><br><span class="line"><span class="function"><span class="title">compute</span><span class="params">(Transcation trans)</span></span>&#123;</span><br><span class="line">    trans.d = trans.b * trans*c;</span><br><span class="line">    <span class="keyword">return</span> trans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//引用方法</span></span><br><span class="line">c_trans = compute(c_trans);</span><br></pre></td></tr></table></figure>

<p><strong>方法二：</strong>传递指针</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> </span></span><br><span class="line"><span class="function"><span class="title">compute</span><span class="params">(<span class="keyword">register</span> Transcation *trans)</span></span>&#123;</span><br><span class="line">    trans-&gt;d = trans-&gt;b * trans-&gt;c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用方法</span></span><br><span class="line">compute(c_trans);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Erin-zw"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Erin-zw</p>
  <div class="site-description" itemprop="description">来者犹可追</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">108</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Erin-zw" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Erin-zw" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zw93918@gmail.com" title="E-Mail → mailto:zw93918@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://baidu.com/" title="https:&#x2F;&#x2F;baidu.com" rel="noopener" target="_blank">百度</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://fishc.com.cn/" title="https:&#x2F;&#x2F;fishc.com.cn" rel="noopener" target="_blank">鱼C论坛</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021-07 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Erin-zw</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">201k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">3:03</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax@2.7.8/unpacked/MathJax.js?config=TeX-MML-AM_CHTML';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
